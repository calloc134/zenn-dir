---
title: "OAuth に必要な概念"
---

# OAuth に必要な概念

この章では、OAuth を理解するために必要な基本的な概念を解説していきます。

## リソース認可とは

**リソース認可**とは、リソースの所有者が、リソースへのアクセスを第三者に許可することです。

前章の例で言えば：

- **リソースの所有者**：あなた（Google Photo のユーザ）
- **リソース**：あなたの写真
- **第三者**：印刷サービス

「あなたが、印刷サービスに、あなたの写真へのアクセスを許可する」— これがリソース認可です。

では、この認可を実現するために必要な概念を順に見ていきましょう。

## アクセストークン — リソースアクセスのための「鍵」

**アクセストークン**とは、リソースにアクセスするための「鍵」です。

この鍵を持っていれば、誰でもリソースにアクセスできます。印刷サービスがあなたの写真にアクセスできるのは、この鍵（アクセストークン）を持っているからです。

### アクセストークンの重要な特性

アクセストークンには、以下のような特性があります：

1. **持っているだけでアクセスできる**

   - 一般的なアクセストークンは、「誰が使っているか」を検証しません
   - 鍵を持っている人が誰であろうと、リソースにアクセスできてしまいます

2. **漏洩すると危険**

   - 一度漏洩すると、第三者がリソースにアクセスできてしまいます
   - だからこそ、鍵の管理は非常に重要です

3. **有効期限は短い方が良い**
   - 漏洩のリスクを軽減するため、有効期限は短く設定することが推奨されます

> トークンは認可情報を取り出すための識別子を表したり, 検証可能な方法でそれ自身に認可情報を含んでもよい.
>
> — [RFC 6749 Section 1.4](https://www.rfc-editor.org/rfc/rfc6749#section-1.4)

:::message
**余談：アクセストークンの形式**

アクセストークンには、大きく分けて 2 つの形式があります：

- **Handle 式**：ランダム文字列（不透明なトークン）
- **Assertion 式**：JWT のような解析可能なトークン

これについては後の章で詳しく解説します。
:::

:::message
**余談：利用者を検証するトークン**

近年では、アクセストークンの利用者を検証する仕組みが増えてきています。

- 一般的なアクセストークンは「**ベアラートークン（Bearer Token）**」と呼ばれます
- 利用者を検証する仕組みを持つものは「**Sender-Constrained Token**」と呼ばれます
- 具体例として mTLS（Mutual TLS）や DPoP（Demonstrating Proof of Possession）があります

これらについては応用編で解説します。
:::

## スコープ — アクセス権の範囲を指定する

**スコープ**とは、リソースへのアクセス権の範囲を指定する仕組みです。

「写真へのアクセス」と一言で言っても、実際にはさまざまな操作があります：

- すべての画像を読み取る
- 特定の画像だけを読み取る
- 新しい画像をアップロードする
- 画像を削除する

これらの操作のうち、どこまでを許可するかを指定するのがスコープです。

### スコープの指定方法

スコープは、スペース区切りの文字列で指定します。例えば：

```
photoslibrary.readonly photoslibrary.sharing
```

### 具体例：Google Photos API のスコープ

Google Photos API では、以下のようなスコープが定義されています：

| スコープ                   | 説明                     |
| -------------------------- | ------------------------ |
| `photoslibrary.readonly`   | 写真の読み取りのみ       |
| `photoslibrary.appendonly` | 新しいメディアの追加のみ |
| `photoslibrary.sharing`    | 共有設定の変更           |

印刷サービスであれば、`photoslibrary.readonly` だけで十分でしょう。削除権限まで与える必要はありません。

### スコープを設計する際の考え方

もし自分でスコープを設計するときは、以下の点を考慮しましょう：

1. **最小権限の原則**

   - 必要最小限の権限だけを与える
   - 「念のため全権限」は危険

2. **リソースと操作の組み合わせ**

   - 単純なリソース：読み取り / 書き込み での分離
   - 複雑なリソース：リソース × 操作 での分離

3. **ドメイン知識に基づく設計**
   - 各サービスのビジネスロジックに応じた設計が必要
   - 汎用的な正解はない

## まとめ

この章では、OAuth に必要な 2 つの重要な概念を学びました：

1. **アクセストークン**

   - リソースにアクセスするための「鍵」
   - 持っているだけでアクセスできる
   - 漏洩すると危険なので、管理と有効期限の設定が重要

2. **スコープ**
   - アクセス権の範囲を指定する仕組み
   - 最小権限の原則に従って設計する

次の章では、OAuth に登場する人物（ロール）について解説していきます。
