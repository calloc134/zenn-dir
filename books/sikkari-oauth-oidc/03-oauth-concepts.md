---
title: "OAuthに必要な概念"
free: true
---

## 概要

リソース認可とは、**リソースの所有者が、リソースへのアクセスを第三者に許可すること**です。

この章では、OAuth を理解するために必要な基本概念を順に説明していきます。

## アクセストークン

### アクセストークンとは

**アクセストークン**は、リソースアクセスのための「鍵」です。

![](/images/03-oauth-concepts/2025-12-01-20-21-20.png)

アクセストークンを持っていれば、リソースサーバにアクセスしてリソースを取得できます。
言い換えると、この鍵を持っている人は誰でもリソースにアクセスできるということです。[^rfc6749-access-token]

[^rfc6749-access-token]: RFC 6749 では、アクセストークンについて「保護されたリソースにアクセスするために使用されるクレデンシャルである」と説明されています。https://www.rfc-editor.org/rfc/rfc6749.html#section-1.4

### 鍵としての特性

アクセストークンは鍵と同じ特性を持っています。

- **持っていれば使える**: 鍵の利用者を検証しない (一般的な場合)
- **漏洩のリスク**: 一度漏洩すると誰でもリソースにアクセスできてしまう
- **管理が重要**: 漏洩が危険だからこそ、鍵の管理は非常に重要
- **有効期限は短く**: 漏洩に備え、鍵の有効期限を短く保つことが推奨

:::message
**余談：アクセストークンの形式**

アクセストークンの形式には大きく分けて 2 種類あります。
詳細は後の章で解説しますが、ランダム文字列のような不透明なトークンと、JWT のような解析可能なトークンがあります。
:::

:::message
**余談：Sender-Constrained Token**

近年では、アクセストークンの利用者を検証する仕組みが増えてきています。
詳細は応用編で解説しますが、代表的な仕組みを名前だけ挙げておきます。

- **MTLS（Mutual TLS）**: クライアント証明書を使った認証
- **DPoP（Demonstrating Proof of Possession）**: 鍵の所持証明

このような仕組みを持つアクセストークンは **Sender-Constrained Token** と呼ばれます。
それに対して従来の「持っていれば誰でも使える」アクセストークンは、 **Bearer Token** と呼ばれます。

本書では、まず Bearer Token を前提に解説を進めます。
:::

## スコープ

### スコープとは

**スコープ**は、リソースへのアクセス権の範囲を指定する仕組みです。[^rfc6749-scope]

![](/images/03-oauth-concepts/2025-12-01-20-23-26.png)

アクセストークンには、「どのリソースに」「どのような操作を」許可するかという情報が紐付けられています。この範囲を指定するのがスコープです。

スコープはスペース区切りの文字列で複数指定できます。

[^rfc6749-scope]: RFC 6749 Section 3.3 では、スコープについて「認可サーバはアクセス範囲を指定するために scope を利用し, クライアントの認可要求のスコープに基づいて認可サーバのポリシーまたはリソースオーナーの指示に従いアクセストークンを発行することができる」と説明されています。https://www.rfc-editor.org/rfc/rfc6749.html#section-3.3

### 具体例：Google Photos API のスコープ

Google Photos API では、以下のようなスコープが定義されています。

| スコープ                                                   | 説明                                |
| ---------------------------------------------------------- | ----------------------------------- |
| `https://www.googleapis.com/auth/photoslibrary.readonly`   | Google フォトの読み取り専用アクセス |
| `https://www.googleapis.com/auth/photoslibrary.appendonly` | 新しいメディアの追加のみを許可      |
| `https://www.googleapis.com/auth/photoslibrary.sharing`    | 共有設定の変更を許可                |

印刷サービスであれば、`photoslibrary.readonly`（読み取り専用）のスコープだけを要求すれば十分でしょう。写真を削除する必要はないので、余計な権限は要求しません。

### スコープを設計するときのポイント

本ブックでは OAuth の基本概念を学ぶことを目的としているため、スコープの詳細な設計方法については深掘りしません。
自分でスコープを設計する場合は、以下の点を考慮しましょう。

1. **最小権限の原則**: 必要最小限の権限だけを付与する
2. **読み取り/書き込みの分離**:
   単純なリソースであれば、読み取りと書き込みで分離する
3. **リソース × 操作での分離**:
   複雑なリソースであればリソースの種類と操作の組み合わせで分離する

スコープの設計は各サービスのドメイン知識に依存するため、一概に「こうすべき」とは言えません。
しかし、ユーザに過剰な権限を与えないよう、十分にスコープを切り分けた設計を心がけましょう。

![](/images/03-oauth-concepts/2025-12-01-20-26-16.png)
