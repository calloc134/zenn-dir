---
title: "OAuth認可コードフローの簡易的解説"
free: true
---

## 概要

この章では、OAuth の代表的なフローである**認可コードフロー**について簡易的に解説します。

ここでは **Confidential Client** を前提とします。
セキュリティ機構（PKCE、state など）については後の章で解説するため、まずはフローの基本的な流れを理解しましょう。

## フローに登場するクレデンシャル

### アクセストークン

前章 [4 章 OAuth の登場人物](/calloc134/books/sikkari-oauth-oidc/viewer/04-oauth-actors)で解説した通り、アクセストークンはリソースアクセスのための「鍵」です。

### 認可コード

**認可コード**は、アクセストークンを引き換えるための一時的な「引換券」です。[^rfc6749-auth-code]
特徴は以下の通りです。

- 一度使うと無効になる
- 有効期限は短い方が望ましい（一般的に数分程度）
- 直接アクセストークンを受け取るのではなく
  認可コードを経由することでセキュリティが向上する

![](/images/05-auth-code-flow-simple/2025-12-01-22-03-38.png)

[^rfc6749-auth-code]: RFC 6749 Section 1.3.1 において、認可コードは「クライアントが認可サーバーを仲介してリソースオーナーから取得する」と説明されています。https://www.rfc-editor.org/rfc/rfc6749.html#section-1.3.1

「なぜ認可コードを経由するのか？」という疑問については、後の章で詳しく解説します。

## フローの流れ

認可コードフローは、以下のような流れで行われます。

```mermaid
sequenceDiagram
    participant RO as リソースオーナー
    participant C as クライアント
    participant AS as 認可サーバ

    RO->>C: リソースにアクセスしてほしい
    C->>RO: まずは認可コードを取ってきてください
    RO->>AS: 認可してください
    AS->>AS: リソースオーナーを認証<br>リソース認可同意
    AS->>AS: 認可コードを発行
    AS->>RO: 認可しました（認可コードを渡す）
    RO->>C: 認可コードを渡す
    C->>AS: 認可コードを持っているので<br>アクセストークンをください
    AS->>AS: 認可コードを検証
    AS->>AS: アクセストークンを発行
    AS->>C: アクセストークン
```

### ステップ 1：フロー開始

1. リソースオーナーがクライアントに対し
   「リソースにアクセスしてほしい」とリクエストする
2. クライアントがリソースオーナーに対し
   「まずは認可コードを取ってきてください」と応答し、
   認可サーバにリダイレクトさせる

![](/images/05-auth-code-flow-simple/2025-12-01-22-06-21.png)

リソースオーナーが認可サーバに認可を求める準備が整いました。

### ステップ 2：認可コード取得

3. リソースオーナーが認可サーバにアクセスし、「認可してください」とリクエストする
4. 認可サーバがリソースオーナーを認証し、認可コードを発行する
5. 認可サーバがリソースオーナーに認可コードを持たせ、クライアントにリダイレクトさせる
6. リソースオーナーはクライアントに対して認可コードを渡す

![](/images/05-auth-code-flow-simple/2025-12-01-22-18-02.png)

リソースオーナーは、認可サーバに働きかけて認可をもらい、それをクライアントに伝えました。
今度は、クライアントがアクセストークンの取得を始めます。

### ステップ 3：アクセストークン取得

7. クライアントが認可コードを持って認可サーバにアクセスし
   「アクセストークンをください」とリクエストする
8. 認可サーバが認可コードを検証し、成功すればアクセストークンを発行する
9. 認可サーバがクライアントに対してアクセストークンを返す

クライアントは認可サーバに、鍵をわたすよう要求します。
認可が降りているため、クライアントは鍵の取得に成功します。

![](/images/05-auth-code-flow-simple/2025-12-01-22-19-24.png)

こうして、クライアントはリソースにアクセスするための鍵、つまりアクセストークンを取得しました。
クライアントはこのアクセストークンを用いてリソースサーバにアクセスし、リソースを取得できるようになります。

## まとめ

最終的にクライアントがアクセストークンを取得して、フローは終了します。

「認可コードを挟むステップのせいで煩雑になっている」と感じるかもしれませんが、
これは **セキュリティ向上のために必要なステップ** です。

詳細は後の章で解説しますが、認可コードを経由することで、

- アクセストークンがブラウザなどのフロントエンドを経由しない
- 認可コードが漏洩しても、それだけではアクセストークンは取得できない

といったメリットがあります。

## 余談：認可コードフロー以外のフロー

OAuth には、認可コードフロー以外にも**インプリシットフロー**というものが存在します。

インプリシットフローは、認可コードを介さずに直接アクセストークンを取得するフローです。しかし、セキュリティ上の問題から**現在は非推奨**となっています。

インプリシットフローの詳細と非推奨の理由については、後の章で解説します。
その際、「なぜ認可コードを挟むことが重要なのか」という問題も、より深く理解できるようになるでしょう。
