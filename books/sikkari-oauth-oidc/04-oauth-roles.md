---
title: "OAuth の登場人物"
---

# OAuth の登場人物

この章では、OAuth に登場する人物（ロール）について解説していきます。

## 概要

リソース認可には、以下のような登場人物が関わってきます：

- **リソースの持ち主** — 誰がリソースを所有しているか
- **リソースを管理している保管庫** — どこにリソースが保存されているか
- **保管庫へのアクセスを管理している認可局** — 誰がアクセス権を発行するか
- **リソースにアクセスする第三者** — 誰がリソースにアクセスしたいか

ここでは、Google Photos を例に説明していきます。

## リソースオーナー

**リソースオーナー**は、リソースの持ち主です。

- Google Photos に画像を保存しているユーザがリソースオーナーです
- 認可局（認可サーバ）に「このクライアントにアクセスを許可していいですよ」と伝える主体です
- OAuth のフローにおいて、認可の意思決定を行う重要な存在です

## リソースサーバ

**リソースサーバ**は、リソースオーナーの持つリソースを管理している保管庫です。

- 実際に写真データを保存しているサーバがリソースサーバです
- アクセストークンを受け取り、それを検証します
- 検証に成功すれば、リソースへのアクセスを許可します

## 認可サーバ

**認可サーバ**は、保管庫へのアクセスを管理している認可局です。

- リソースオーナーからの許可を得て、アクセストークンを発行します
- リソース自体は持っていませんが、リソースへのアクセス権（アクセストークン）を発行する権限を持っています
- Google の場合、OAuth 専用のサーバがこの役割を担います

:::message
**認可サーバとリソースサーバの関係**

認可サーバとリソースサーバは、比較的近い位置にあることが多く、同じサーバであることも多いです。

> 認可サーバーとリソースサーバー間のやりとりについては本仕様書の範囲外である. 認可サーバーはリソースサーバーと同一のサーバーでも異なるサーバーでもよい.
>
> — [RFC 6749](https://www.rfc-editor.org/rfc/rfc6749)

:::

## クライアント

**クライアント**は、リソースにアクセスする第三者です。

- 印刷サービスなど、リソースオーナーに代わってリソースにアクセスするアプリケーションです
- リソースオーナーから許可を得て、認可サーバからアクセストークンを取得します
- 取得したアクセストークンを使って、リソースサーバのリソースにアクセスします

## 4 つの登場人物の関係性

これらの登場人物の関係を整理すると、以下のようになります：

```
┌─────────────────┐     ①許可を与える     ┌─────────────────┐
│                 │ ──────────────────→  │                 │
│ リソースオーナー  │                       │    認可サーバ    │
│  (ユーザ)        │  ←──────────────────  │                 │
└─────────────────┘   ②認可コードを発行    └─────────────────┘
                                                  │
                                                  │ ③アクセストークン
                                                  │   を発行
                                                  ↓
┌─────────────────┐   ④アクセストークン    ┌─────────────────┐
│                 │ ──────────────────→  │                 │
│   クライアント   │                       │  リソースサーバ  │
│  (印刷サービス)   │  ←──────────────────  │  (Google Photos) │
└─────────────────┘     ⑤リソースを返却    └─────────────────┘
```

1. リソースオーナーが認可サーバに「クライアントにアクセスを許可する」と伝える
2. 認可サーバがリソースオーナーに認可コードを発行
3. クライアントが認可コードを使ってアクセストークンを取得
4. クライアントがアクセストークンを使ってリソースサーバにアクセス
5. リソースサーバがリソースを返却

（詳細なフローは後の章で解説します）

## 余談：OAuth「クライアント」という名前について

OAuth では「クライアント」という言葉が登場しますが、これは**サーバ・クライアントモデルにおけるクライアント（ユーザのブラウザなど）とは異なる概念**です。

「OAuth クライアント」という呼称で混同されがちですが、これはあくまで **OAuth フローにおける役割（ロール）** を指しています。

実際には：

- OAuth クライアントがサーバサイドで動作することはよくあります
- むしろ、サーバサイドで動作する方がセキュリティ上好ましいケースも多いです

## 余談：クライアントの種類

OAuth クライアントには、大きく分けて 2 つの種類があります：

| 種類                    | 説明                                                     |
| ----------------------- | -------------------------------------------------------- |
| **Confidential Client** | クライアントシークレットを安全に保管できるクライアント   |
| **Public Client**       | クライアントシークレットを安全に保管できないクライアント |

この違いは非常に重要で、後の章で詳しく解説します。

このブックでは、まず **Confidential Client** を前提として解説を進めます。具体的には、Rails のような昔ながらの MPA（Multi-Page Application）、つまりサーバサイドで動作する Web アプリケーションを想定しています。

Public Client については、後半の章で詳しく解説します。

## まとめ

OAuth には 4 つの登場人物（ロール）があります：

| ロール           | 役割                             | 例                     |
| ---------------- | -------------------------------- | ---------------------- |
| リソースオーナー | リソースの所有者                 | ユーザ                 |
| リソースサーバ   | リソースを保管するサーバ         | Google Photos のサーバ |
| 認可サーバ       | アクセストークンを発行するサーバ | Google OAuth サーバ    |
| クライアント     | リソースにアクセスする第三者     | 印刷サービス           |

次の章では、これらの登場人物がどのようにやり取りするのか、OAuth のフローについて解説していきます。
