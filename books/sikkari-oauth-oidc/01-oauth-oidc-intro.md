---
title: "OAuth と OIDC とは"
---

# はじめに

この本では、OAuth と OIDC について丁寧に解説していきます。

OAuth と OIDC は、現代の Web サービスにおいて非常に重要な技術です。しかし、その仕組みを正しく理解することは難しく、「なんとなく使っている」という方も多いのではないでしょうか。

この本では、OAuth と OIDC のフローについて、実際に疑問に思いやすいことをベースに解説していきます。

:::message alert
OIDC の実装などで Auth0 などの IDaaS を利用することが良くあると思います。
しかし、IDaaS の実装はベンダーによって独自性が強く、その認識が学習の妨げとなる場合もあります。ここではとりあえず既存の IDaaS の仕様を一旦忘れてから、この本を読んでみることをおすすめします。
:::

# OAuth とは

OAuth は、リソースの所有者が、リソースへのアクセスを第三者に許可するための仕組みです。

![](/images/5e8da6c491e720/2025-02-05-15-20-33.png)

例えば、自分の所持している写真を、Google Photo のようなオンラインアルバムサービスで管理していたとします。
このアルバムサービスとは関係ない印刷サービスに自分の写真を印刷してもらいたい場合、「印刷サービスにだけ、特別に、自分の写真を見る権限を与える」ということを実現するための仕組みが OAuth です。

具体的には、アクセストークンと呼ばれる鍵を利用することで、リソースへのアクセスができるようになります。先程の例で言うと、自分の写真を見る権限を持つアクセストークンを印刷サービスに渡すことで、印刷サービスは自分の写真を見ることができるようになります。

![](/images/5e8da6c491e720/2025-02-05-15-25-29.png)

移譲できる権限についてはシステムの実装に左右されますが、アルバムサービスの写真というリソースに対しての場合、以下のような権限が考えられます。

- すべての画像の読み取り権限
- 限定された画像の読み取り権限
- アップロードを行う権限
- 画像を削除できる権限

これらの権限の違いはスコープと呼ばれるもので表現されますが、詳細は後述します。

![](/images/5e8da6c491e720/2025-02-05-15-23-09.png)

> OAuth 2.0 は, サードパーティーアプリケーションによる HTTP サービスへの限定的なアクセスを可能にする認可フレームワークである^[https://openid-foundation-japan.github.io/rfc6749.ja.html#toc].

OAuth は、RFC6749 で定義されています^[https://openid-foundation-japan.github.io/rfc6749.ja.html]。日本語訳が存在しているので、必要に応じて参照してみてください。

# OIDC とは

OIDC は、ユーザが、第三者に対して自分がどのような人物であるかを示し、これを用いて認証を行うための仕組みです。

![](/images/5e8da6c491e720/2025-02-05-15-29-31.png)

例えば、Google のアカウントを持っているユーザが、Zenn のような他のサービスにログインする場合、Google のアカウント情報を使ってログインすることができます。

具体的には、 ID トークンと呼ばれるプロフィール証明書のようなトークンを利用することで、ユーザのプロフィールを提示し、これを第三者が信頼することで、ログインを行うことができます。先程の例で言うと、Google のアカウントの簡単な情報が ID トークンに格納され、これを使ってログインを行うことができます。

> OpenID Connect 1.0 は, OAuth 2.0 プロトコルの上にシンプルなアイデンティティレイヤーを付与したものである^[http://openid-foundation-japan.github.io/openid-connect-core-1_0.ja.html#Introduction].

OIDC についても仕様が定義されています^[http://openid-foundation-japan.github.io/openid-connect-core-1_0.ja.html]。それぞれ、日本語訳が存在しているので、必要に応じて参照してみてください。

# 2 つの目的の違い

OAuth と OIDC について、以下のようにざっくりとした違いを理解しておきましょう。

- OAuth は、ユーザが、所有するリソースへのアクセスを第三者に許可するための仕組み
- OIDC は、ユーザが、第三者に対して自分がどのような人物であるかを示し、これを用いて認証を行うための仕組み

![](/images/5e8da6c491e720/2025-02-05-15-37-09.png)

OAuth は、ユーザが持っているリソースを第三者に認可するための仕組みです。したがって、**認可**の仕組みとみなされます。
OIDC は、ユーザの識別情報(ユーザがどのような人物であるかを示す情報、つまりプロフィール)を第三者に信頼してもらい、その情報をもって認証とする仕組みです。したがって、**認証**の仕組みとみなされます。

**つまり、OAuth と OIDC のユースケースは全く別物なのです。**

:::message
余談ですが、OAuth は色々なリソースの認可に関連するため、仕様としてはふんわりとした特色があります。
それに対し、OIDC は認証のユースケースに特化しており、実装者の独自実装が入りうる余地は比較的少ないです。
:::

# 目的は異なるが、技術的には「追加レイヤ」

OAuth と OIDC は目的こそ全く異なりますが、技術的には OIDC は OAuth に対する「追加レイヤ」として構築されています。

これはどういうことでしょうか？

OAuth はリソースへのアクセスを第三者に許可するための仕組みです。
しかし、OAuth の仕組みを用いることで、認証用途にも転用できることが、OAuth ユーザによって発見されました。

まず、ユーザのプロフィールをリソースとして考えます。次に、第三者にプロフィールへのアクセスを許可すれば、そのプロフィールで身分証明ができます。そして、これを認証用途に使うことができるという形です。

![](/images/5e8da6c491e720/2025-02-05-15-40-25.png)

OAuth を認証用途として利用できるというのは、いわば発明だったと言えるでしょう。
プロフィールをリソースとして提供する API はプロフィール API と呼ばれ、このような実装を OAuth + プロフィール API と呼びます。

:::message alert
この仕組みについて、俗に「OAuth 認証」と呼ばれることがありますが、あまり適切な表現ではないので、避けるようにしましょう。

OAuth は認可の仕組みであり、識別情報を用いた認証への応用は規格として定義されていません。そのため、実装者が独自に拡張しているということになります。
実装者が独自に拡張している実装なので、もちろん実装方法もバラバラで統一されていません。万が一「OAuth 認証」のような言葉を議論に用いてしまうと、そういう実装が明確に存在すると誤解した認識が開発者の間に広まってしまいます。結果的に、勘違いした開発者によってバラバラな実装が更に広まることになりかねません。
そのため、OAuth + プロフィール API のような実装を、「OAuth 認証」と呼ぶのは避けるようにしましょう。
:::

OAuth + プロフィール API の実装について、実装者が独自実装を行うことが多かったため、このような認証の仕組みを規格として定義することが自然と求められました。そこで誕生したものが OIDC です。

OIDC では、プロフィール API に当たるものを専用のトークン（ID トークン）として定義し、それを用いて認証を行う仕組みを提供しています。

**「OIDC は OAuth にアイデンティティレイヤーを載せたものである」** と言われるのは、このような理由からです。つまり、OAuth の仕組みをベースにしつつ、認証のための機能を「追加」したものが OIDC なのです。

参考リンク
https://ritou.hatenablog.com/entry/2020/12/01/000000
https://ritou.hatenablog.com/entry/2024/02/11/153633
https://booth.pm/ja/items/1550861
