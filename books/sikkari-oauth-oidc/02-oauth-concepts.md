---
title: "OAuth に必要な概念"
---

# リソース認可とは何をすべきか

OAuth は、リソースの所有者が、リソースへのアクセスを第三者に許可するための仕組みです。
では、「リソース認可」とは具体的に何をすることなのでしょうか？

リソース認可とは、以下のことを実現することです。

1. **リソースの所有者が、自分のリソースへのアクセスを許可する意思を示す**
2. **許可された第三者のみが、そのリソースにアクセスできるようにする**
3. **許可の範囲を限定できるようにする**（すべてではなく、一部のみを許可する）

例えば、Google Photo に保存された自分の写真を印刷サービスに共有する場合を考えてみましょう。

- 写真を印刷サービスに見せたいが、削除はされたくない
- すべての写真ではなく、特定のアルバムだけを共有したい
- いつでも許可を取り消せるようにしたい

このような「細かい制御」を可能にするのが、OAuth の役割です。

# スコープとは何か

OAuth では、許可する権限の範囲を「スコープ」と呼びます。

## スコープの役割

スコープは、リソースへのアクセスを許可する際に、**どのようなアクセスを許可するのか**を指定するためのものです。

どのようなスコープが存在するかについては、それぞれの認可サーバの仕様によって異なります。

## スコープの例

例として、Google Photos API におけるスコープの一例を挙げてみます。

| スコープ                                                 | 説明                                            |
| -------------------------------------------------------- | ----------------------------------------------- |
| https://www.googleapis.com/auth/photoslibrary.readonly   | Google フォトの読み取り専用アクセス             |
| https://www.googleapis.com/auth/photoslibrary.appendonly | Google フォトへの新しいメディアの追加のみを許可 |
| https://www.googleapis.com/auth/photoslibrary.sharing    | Google フォトの共有設定の変更を許可             |

参考: https://developers.google.com/photos/overview/authorization?hl=ja

## スコープの設計

スコープの設計において、一般的に以下のような考え方があります。

### 読み取り / 書き込みの分離

- `read` - リソースの読み取りのみを許可
- `write` - リソースの書き込み（作成・更新）を許可
- `delete` - リソースの削除を許可

### リソースの種類ごとの分離

- `profile` - プロフィール情報へのアクセス
- `email` - メールアドレスへのアクセス
- `photos` - 写真へのアクセス

### 最小権限の原則

スコープを設計する際は、**最小権限の原則**に従うことが重要です。つまり、必要最小限の権限のみを要求するようにします。

例えば、写真を表示するだけのアプリケーションであれば、`readonly` のスコープのみを要求し、削除や書き込みの権限は要求すべきではありません。

## フローにおけるスコープの指定

フローの中では、これらのスコープをスペース区切りの形式でリクエストに含めることで、リソースへのアクセスを許可する際に、どのようなアクセスを許可するのかを指定することができます。

```
scope=photoslibrary.readonly photoslibrary.sharing
```

# まとめ

- **リソース認可**とは、リソースの所有者が第三者にリソースへのアクセスを許可し、その範囲を制御すること
- **スコープ**は、許可するアクセスの範囲を表現するもの
- スコープの設計は認可サーバによって異なり、最小権限の原則に従うことが重要
