---
title: "アクセストークンの形式"
---

# アクセストークンの形式

この章では、OAuth におけるアクセストークンの形式について解説します。

## 概要

OAuth 自体は、アクセストークンの形式を規定していません。

> トークンは認可情報を取り出すための識別子を表したり, 検証可能な方法でそれ自身に認可情報を含んでもよい.
>
> — [RFC 6749](https://www.rfc-editor.org/rfc/rfc6749)

つまり、サービスによってアクセストークンの形式は異なります。ランダムな文字列であっても、JWT のような構造化されたトークンであっても構いません。

## アクセストークンの形式の種類

OAuth 2.0 の脅威モデルを解説している RFC 6819 では、アクセストークンを以下の 2 種類に分類しています：

### Handle 式トークン

**Handle 式トークン**（Opaque トークンとも呼ばれます）は、ランダム文字列からなる不透明なトークンです。

> "handle" ("artifact" とも呼ばれる) とは, 認可サーバー内部のデータ構造に対するある種の参照である.
>
> — [RFC 6819](https://www.rfc-editor.org/rfc/rfc6819)

Handle 式トークンの特徴：

- **ランダム文字列**であり、トークン自体から情報を読み取ることはできない
- 認可サーバ内部のデータを**参照するキー**として機能する
- トークンの詳細を知るには、認可サーバに問い合わせる必要がある

### Assertion 式トークン

**Assertion 式トークン**は、トークンそのものに意味があり、解析が可能なトークンです。代表例が **JWT（JSON Web Token）** です。

> assertion とはパース可能なトークンである. assertion は典型的には有効期間, 発行対象 (audience) を持ち, 改竄防止および発行者認証のため電子署名が付けられる.
>
> — [RFC 6819](https://www.rfc-editor.org/rfc/rfc6819)

Assertion 式トークンの特徴：

- トークンを**解析することで情報を取得できる**（発行者、有効期限、スコープなど）
- **電子署名**を持ち、改ざん検知が可能
- 認可サーバに問い合わせなくても、トークンの内容を検証できる

## それぞれのメリットとデメリット

### Handle 式トークンのメリット・デメリット

**メリット**：

- トークンが漏洩しても、認可サーバ側で**無効化が容易**
- データは認可サーバ側で一元管理されるため、**変更を即座に反映**できる

**デメリット**：

- リソースサーバがトークンの詳細を知るために、**認可サーバに問い合わせる必要がある**
- そのため、**パフォーマンスに影響**が出る可能性がある

### Assertion 式トークンのメリット・デメリット

**メリット**：

- リソースサーバが認可サーバに問い合わせなくても、トークンの詳細情報を取得できる
- **パフォーマンスが良い**

**デメリット**：

- トークンが漏洩した場合、認可サーバ側で**無効化が難しい**
- トークンに含まれる情報が**古くなる可能性**がある
- 失効（Revocation）の実装が難しい

:::message
**Assertion 式トークンの失効問題**

Assertion 式トークンは、発行時点の情報がトークンに埋め込まれています。そのため、以下のような問題が発生します：

- ユーザの権限が変更されても、既存のトークンには反映されない
- トークンを「失効」させたくても、トークン自体が有効期限内であれば使えてしまう

この問題に対処するため、Assertion 式トークンでは**有効期限を短く設定する**ことが一般的です。
:::

## まとめ

| 形式         | 特徴                 | メリット                     | デメリット       |
| ------------ | -------------------- | ---------------------------- | ---------------- |
| Handle 式    | ランダム文字列       | 失効が容易、リアルタイム反映 | 問い合わせが必要 |
| Assertion 式 | 解析可能（JWT など） | パフォーマンスが良い         | 失効が困難       |

OAuth 自体はアクセストークンの形式を規定していないため、**どちらの形式を採用するかは実装者の自由**です。

サービスの特性や要件に応じて、適切な形式を選択することが重要です。

次の章では、クライアント登録とクライアント認証について解説していきます。
