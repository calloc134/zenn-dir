`sikkari-oauth-oidc` ディレクトリ以下で、
OAuth の解説を行っています。

しかし、06 セクション と 07 セクションの間に、
「(リソースサーバにおける) アクセストークンの検証手順」
というセクションを入れ忘れてしまいました。

以下の処理を行ってください。

- 07 以降のセクションを一つずつ後ろにずらす
- 箇条書きの内容に沿って、アクセストークン検証手順のセクションを追加する

箇条書きは以下の通りです。

---

- 概要
  - リソースサーバが アクセストークンを受け取った際に
  - その有効性とメタデータを検証する必要がある
  - その具体的な手順について解説する
- 両者に共通する検証手順
  - リソースサーバ (RS) は
  - アクセストークン (AT) を受け取った際に
  - まずは AT の有効性を検証する必要がある
    - 該当する AT が存在し、正しく発行されたものであるか
    - AT が有効期限内であるか
  - 有効性検証に成功した場合、AT に紐づくメタデータを取得する
  - メタデータを用いて、リクエストの妥当性を確認する
  - 検証において必要なメタデータはおおよそ次の通り
    - 発行者 (issuer)
      - AT を発行した認可サーバの識別子
      - AT の識別子と一致する必要がある
    - 受信者 (audience)
      - AT の受信者を示す識別子
      - RS が、 「AT が自分宛てのものである」 ことを確認するために使用する
      - AT を受け取った RS の識別子と一致する必要がある
    - スコープ (scope)
      - AT に紐づくスコープ情報
      - RS はリクエストされた操作がスコープ内か確認する
      - スコープの検証は実装に依存するため、具体的な方法はここでは解説しない
  - 明確な仕様が決まっている訳ではないため、
  - 実装ごとに異なる場合がある
- Handle 式 アクセストークンに関連する仕様
  - handle 式 AT を利用する場合、
    - そのままだとランダムな文字列 (opaque)
    - RS が AT の内容を理解できない
  - そこで、RS は AS に問い合わせて AT の内容を確認する
  - 認可サーバが AT の情報を返すエンドポイントを用意する必要がある
    - OAuth 2.0 Token Introspection エンドポイント
    - RFC 7662 で定義されている
    - RS はこのエンドポイントに AT を送信し、
    - 以下の内容を自分で検証する
      - AT が有効かどうか
        - AT の有効性自体は AS が判断する
          - AT が発行されたかどうか
          - AT が有効期限内かどうか
        - したがって、RS は AS の応答を確認するだけで良い
        - `active` フィールドが true であれば有効
      - AT に紐づくメタデータ
      - 検証に関連するフィールドは以下の通り
        - `iss` 発行者 (issuer)
        - `aud` 受信者 (audience)
        - `scope` スコープ (scope)
        - `exp` 有効期限 (expiration time)
          - 有効期限内であれば `active` が true になるので
          - `exp` を検証する必要はないことが多い
        - その他
      - Introspection API のレスポンスには
        - JWT のペイロードに含まれる情報と
        - 等価なものが返されるケースが多い
- Assertion 式 アクセストークンに関連する仕様
  - Assertion 式 AT で一番有名なのは JWT 形式の AT
  - JWT 形式の AT 仕様 → RFC 9068 で定義されている
  - JWT の詳細仕様については OIDC で解説しているが、
  - ここでは簡単に解説する
    - JWT 形式の AT は、署名付きの トークン
    - 以下の内容を自分で検証する
      - AT が有効かどうか
        - AT が改ざんされておらず、発行者が正しいか(署名検証)
        - AT が有効期限内かどうか (`exp` クレーム)
      - AT に紐づくメタデータ
      - 検証に関連するフィールドは以下の通り
        - `iss` 発行者 (issuer)
        - `aud` 受信者 (audience)
        - `scope` スコープ (scope)
        - その他
- まとめ
  - リソースサーバはアクセストークンを受け取った際に
  - その有効性とメタデータを検証する必要がある
  - 検証手順はアクセストークンの形式によって異なる場合があるが、
  - おおよそ手順は共通している
    - アクセストークンの有効性
      - 該当するアクセストークンが存在し、正しく発行されたものであるか
      - アクセストークンが有効期限内であるか
    - アクセストークンに紐づくメタデータの取得と検証
      - 発行者 (issuer)
      - 受信者 (audience)
      - スコープ (scope)
  - 代表的な形式として、Handle 式と Assertion 式がある
  - それぞれの形式に応じた検証手順を理解し、適切に実装することが重要である
