## 16. 認可コードを不正に取得する攻撃と防御 (public client 編)

- 概要
  - 認可コードを不正に取得する攻撃手法とその防御方法について解説することを明示
  - 今回は public client を対象とすることを明示
- カスタム URI スキームの悪用
  - 攻撃の概要
    - クライアントが public client でネイティブアプリの場合
    - リダイレクトで開かれるアプリが複数選択できる場合がある
      - 例: ブラウザにおいて、`myapp://`のような文字列から始まる URL を開いた時に
      - どのアプリで開くかを選択できる
    - この仕組みは便利だが、同じ URL であっても開くアプリが一意に決まらない場合がある
    - 攻撃者が悪意のあるアプリを用意し、被害者にインストールさせる
    - 被害者が認可リクエストを行い、認可サーバから認可コードが返される
    - リダイレクト URI が`myapp://callback`のような形式である場合
    - 被害者の端末で、悪意のあるアプリが選択されてしまうと
    - 認可コードが攻撃者に渡ってしまう
    - 余談: そもそもユーザ端末に悪意のあるアプリをインストールされていること自体が問題
      - 悪意あるアプリをインストールできた場合の
      - 横展開による被害拡大の手法のひとつとして考えることができる
  - 攻撃の流れ
    - (省略)
  - 攻撃の対策
    - OAuth のフロー側で特に対策できるものはない
    - ネイティブアプリの場合、カスタム URL スキームの使用を避ける
      - 代わりに app-claimed HTTPS URI を利用
          - OSレベルで、
          - メイン所有者がホワイトリストしたアプリだけが
          - その https URL を受け取れるように検証必須とする仕組み
        - iOS では Universal Links
        - Android では App Links
        - OAuth の仕様とは外れるため詳しくは外部記事を参照
    - ユーザ教育
      - 不審なアプリのインストールを避けるようにユーザに注意喚起する
    - もしくは、さらに後手で防御する
      - "認可コードを奪取する攻撃"が通っても
      - それをアクセストークンに交換できないようにすればいいとする考え
        - PKCE の利用

## 17. 認可コードを用いてアクセストークンを不正に取得する攻撃と防御 (public client 編)

## 18. インプリシットフローの解説と非推奨の理由

## 19. ここまでの完全版コードフロー 解説 (public client)

## 20. OAuth まとめと OAuth 2.1 の紹介

## 21. OIDC に必要な概念

## 22. ID トークンの詳細

## 23. OIDC の登場人物

## 24. OIDC 簡易フロー 解説 (認可コードフロー)

## 25. OAuth + プロフィール API による疑似認証の問題点

## 26. OIDC を活用するマインドセット

## 27. ここまでの OIDC 完全コードフロー 解説
