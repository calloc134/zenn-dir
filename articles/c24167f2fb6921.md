---
title: "æˆæ¥­å†…é–‹ç™ºã§éƒ¨å®¤äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ãŸè©±"
emoji: "ğŸ« "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Hono", "PostgreSQL", "React", "shadcn", "å¤§å­¦"]
published: true
---

# ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚calloc134 ã§ã™ã€‚

å‰å›ã®æˆæ¥­å†…ãƒãƒƒã‚«ã‚½ãƒ³è¨˜äº‹ã«ãŠã„ã¦ã€200 ã„ã„ã­ã‚’é ‚ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
https://zenn.dev/calloc134/articles/c5ae165b16b969

è‡ªåˆ†ã®å¤§å­¦ã§ã¯ã€ã“ã‚Œä»¥å¤–ã«ã‚‚æˆæ¥­å†…ã§é–‹ç™ºã‚’è¡Œã†å®Ÿè·µçš„ãªæˆæ¥­ãŒã„ãã¤ã‹å­˜åœ¨ã—ã¾ã™ã€‚
å‰å›ã®æˆæ¥­ã¨ã¯åˆ¥ã«æˆæ¥­å†…é–‹ç™ºã‚’è¡Œã†æ©Ÿä¼šãŒã‚ã£ãŸãŸã‚ã€åŠå¹´ã¶ã‚Šã«å¤§å­¦ã®æˆæ¥­ã¨ã—ã¦é–‹ç™ºã‚’è¡Œã„ã¾ã—ãŸã€‚

# ç°¡å˜ãªæ¦‚è¦

ã“ã®æˆæ¥­ã§ã¯ã€ãƒãƒ¼ãƒ ã§é–‹ç™ºã®åˆ†æ‹…ã‚’è¡Œã„ãªãŒã‚‰æ±ºã‚ã‚‰ã‚ŒãŸæœŸé™ã¾ã§ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ¶ä½œã—ã¦ã„ãã¾ã™ã€‚è‡ªåˆ†ã¯å¾Œè¼©ã¨ãƒãƒ¼ãƒ ã‚’çµ„ã¿ã€é–‹ç™ºã‚’è¡Œã„ã¾ã—ãŸã€‚
æœ¬æ¥ã§ã‚ã‚Œã°ã“ã“ã§é–‹ç™ºã™ã‚‹å†…å®¹ã¯é™çš„ã‚µã‚¤ãƒˆã§ååˆ†ãªã®ã§ã™ãŒã€ã›ã£ã‹ããªã®ã§å‹•çš„ã‚µã‚¤ãƒˆã‚’ä½œã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
å¾Œè¼©ã«èã„ã¦ã¿ãŸã¨ã“ã‚ã€
ã€Œè‡ªåˆ†ã¯è»½éŸ³æ¥½éƒ¨ã«æ‰€å±ã—ã¦ã„ã‚‹ã®ã§ã€ç·´ç¿’å®¤ã®äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚ŠãŸã„ã€ã¨ã®ã“ã¨ã§ã—ãŸã€‚
ä¸åº¦ã„ã„æ©Ÿä¼šã ã¨æ€ã„ã€è‡ªåˆ†ã®æ°—ã«ãªã£ã¦ã„ã‚‹æŠ€è¡“ã‚’åˆ©ç”¨ã—ãªãŒã‚‰é–‹ç™ºã‚’è¡Œã£ã¦ã„ãã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€‚

# å…¨ä½“åƒ

ã¾ãšã¯ã˜ã‚ã«ã€æœ€çµ‚çš„ã«å®Œæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®å…¨ä½“åƒã‚’ç¤ºã—ã¾ã™ã€‚

ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-54-17.png)

ã“ã“ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚
ãªãŠã€èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å¤–éƒ¨é€£æºãŒå¯èƒ½ã¨ãªã£ã¦ã„ã¾ã™ã€‚

- Google
- Discord
- LINE

ãƒ­ã‚°ã‚¤ãƒ³ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-55-20.png)

ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ã®ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-55-31.png)

![](/images/c24167f2fb6921/2024-07-17-12-55-35.png)

å­˜åœ¨ã™ã‚‹ãƒšãƒ¼ã‚¸ã¯ã€äºˆç´„ä¸€è¦§ç¢ºèªç”»é¢ã¨è‡ªåˆ†ã®äºˆç´„ä¸€è¦§ç¢ºèªç”»é¢ã® 2 ã¤ã§ã™ã€‚

äºˆç´„ä¸€è¦§ç”»é¢ã§ã¯ã€ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ã®äºˆç´„ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã€äºˆç´„ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-56-38.png)

![](/images/c24167f2fb6921/2024-07-17-12-56-48.png)

è‡ªåˆ†ã®äºˆç´„ä¸€è¦§ç¢ºèªç”»é¢ã§ã¯ã€è‡ªåˆ†ã®äºˆç´„ã®ç¢ºèªã¨ã¨ã‚‚ã«ã€äºˆç´„ã®å–ã‚Šæ¶ˆã—ãŒå¯èƒ½ã§ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-57-22.png)

![](/images/c24167f2fb6921/2024-07-17-12-57-34.png)

åˆ¶ç´„ã¨ã—ã¦ã€éå»ã‚„å½“æ—¥ã®äºˆç´„ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã¾ãŸã€ä¸€é€±é–“ä»¥å†…ã«ã™ã§ã«äºˆç´„ãŒã‚ã‚‹å ´åˆã‚‚äºˆç´„ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-58-10.png)

![](/images/c24167f2fb6921/2024-07-17-12-58-14.png)

åŠ ãˆã¦ã€äºˆç´„ã®å–ã‚Šæ¶ˆã—ã¯ 3 æ—¥å‰ã¾ã§ã¨ãªã£ã¦ã„ã¾ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-58-27.png)

ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã‚‚è¡Œã„ã€ã‚¹ãƒãƒ›ã‹ã‚‰ã®è¡¨ç¤ºã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

![](/images/c24167f2fb6921/2024-07-17-12-58-46.png)

# ä»•æ§˜

éƒ¨å®¤äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¤ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## æ©Ÿèƒ½è¦ä»¶

- ãƒ¦ãƒ¼ã‚¶ã¯éƒ¨å®¤ã®äºˆç´„ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹
- ãƒ¦ãƒ¼ã‚¶ã¯éƒ¨å®¤ã®äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
- ç®¡ç†è€…ãŒéƒ¨å±‹ã®åˆ©ç”¨ç¦æ­¢æ ã‚’è¨­å®šã§ãã‚‹

è©³ç´°ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- äºˆç´„ã®å‡ºæ¥ã‚‹æ—¥æ™‚ã¯å¹³æ—¥ã®ã¿
- äºˆç´„ã¯å¤§å­¦ã®æˆæ¥­ã®å˜ä½ã¨åŒã˜(å››æ™‚é™ç›®ã¾ã§ãƒ»ä¸€æ—¥ 4 ã‚³ãƒ)
- éå»ãƒ»å½“æ—¥ã®äºˆç´„ã¯ç¦æ­¢
- ä¸€é€±é–“ä»¥å†…ã«äºˆç´„ãŒã‚ã‚‹å ´åˆã¯äºˆç´„ã§ããªã„
- äºˆç´„ã®å–ã‚Šæ¶ˆã—ã¯ 3 æ—¥å‰ã¾ã§

## éæ©Ÿèƒ½è¦ä»¶

- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œ
- èªè¨¼ã«å¯¾å¿œ
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã ã‘ã§ã¯ãªãã€SNS é€£æºã‚‚å¯èƒ½

ã“ã®æ¡ä»¶ã«æ²¿ã£ã¦ã€æŠ€è¡“é¸å®šã‚’è¡Œã„ã¾ã—ãŸã€‚

## æŠ€è¡“é¸å®š

ã“ã“ã§ã€ãã‚Œãã‚Œã®è¦ä»¶ã‚’é”æˆã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæŠ€è¡“é¸å®šã‚’è¡Œã„ã¾ã—ãŸã€‚

- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©
  - Cloudflare Workers
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ FW
  - Hono
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€
  - safeql
- èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
  - Clerk
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  - Neon Database
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ FW
  - React
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  - Tanstack Router
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - Tanstack Query (React Query)
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ UI
  - Tailwind CSS
  - shadcn
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
  - Vite
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - react-hot-toast
  - react-spinners

ã§ã¯ã€ãã‚Œãã‚Œã®æŠ€è¡“ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

### Cloudflare Workers

https://workers.cloudflare.com/

Cloudflare ãŒæä¾›ã™ã‚‹ã€TypeScript ã®ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ç’°å¢ƒã§ã™ã€‚ç„¡æ–™ã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€ã‚¨ãƒƒã‚¸ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒä½ã„ã“ã¨ãŒãƒ¡ãƒªãƒƒãƒˆã®ä¸€ã¤ã§ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã¯æ¯”è¼ƒçš„å³ã—ã„ãŸã‚ã€åŠ¹ç‡çš„ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### Hono

https://hono.dev/

TypeScript ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚Express ã«ä¼¼ãŸ API ã‚’æŒã£ã¦ãŠã‚Šã€ç°¡å˜ã« API ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€Zod ã‚„ Valibot ã®ã‚ˆã†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã€å¾Œè¿°ã™ã‚‹ Clerk ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ IDaaS ã®èªè¨¼ã‚’åˆ¤å®šã™ã‚‹ã‚ˆã†ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å¤šãæä¾›ã—ã¦ãŠã‚Šã€ã‚µãƒãƒ¼ãƒˆãŒæ‰‹åšã„ã“ã¨ãŒç‰¹å¾´ã§ã™ã€‚

### safeql

https://safeql.dev/

TypeScript ã§å‹•ä½œã™ã‚‹ PostgreSQL ç”¨ã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ»SQL æ§‹æ–‡ãƒãƒªãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚eslint ãƒ«ãƒ¼ãƒ«ã§è¨˜è¿°ãŒè¡Œã‚ã‚Œã¦ãŠã‚Šã€sql ã‚¿ã‚°ã§å›²ã¾ã‚ŒãŸ SQL æ–‡ã‚’ PostgreSQL ã§æ¤œè¨¼ã—ã€SQL æ–‡ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ã‚’ä¿è¨¼ã—ã¾ã™ã€‚ã¾ãŸã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã«å¯¾ã— SQL ã®çµæœã‚’è§£æã—ã¦å‹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€SQL ã®å®Ÿè¡Œçµæœã«å‹ãŒä»˜ä¸ã•ã‚Œã€TypeScript ã®å‹å®‰å…¨æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

ORM ã«å¯¾ã—ã¦ã“ã‚Œã‚’é¸ã‚“ã ç†ç”±ã¨ã—ã¦ã¯ã€SQL ã‚’ç›´æ¥æ›¸ããªãŒã‚‰å‹ã®å®‰å…¨æ€§ã‚’ä¿è¨¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ oss ã¨ã—ã¦ä½¿ã£ã¦ã¿ãŸã„æ°—æŒã¡ãŒã‚ã£ãŸãŸã‚ã§ã™ã€‚
TypeScript ã§ã¯ Prisma ORM ã‚„ Drizzle ORM ãŒæœ‰åã§ã™ãŒã€ORM ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã¨ã©ã†ã—ã¦ã‚‚è¡¨ç¾åŠ›ã«é™ç•ŒãŒç”Ÿã˜ã¾ã™ã€‚ã¾ãŸã€æ™®æ®µã®é–‹ç™ºã§ ORM ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€æœ¬æ¥ã® SQL ã‚’ååˆ†ã«å­¦ç¿’ã§ãã¦ã„ãªã„ã¨æ„Ÿã˜ã¦ã„ãŸã‹ã‚‰ã§ã™ã€‚
å‰å›ã®æˆæ¥­å†…ãƒãƒƒã‚«ã‚½ãƒ³ã§ã¯ Drizzle ORM ã‚’åˆ©ç”¨ã—ã¦ã„ãŸã®ã§ã™ãŒã€ä»¥ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šã€ä»Šå›ã¯ ORM ã‚’ä½¿ã‚ãšã« SQL ã‚’ç›´æ¥æ›¸ãã“ã¨ã«ã—ã¾ã—ãŸã€‚

### Neon Database

https://neon.tech/

ã‚µãƒ¼ãƒãƒ¬ã‚¹ã§å‹•ä½œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚Šã€SaaS ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚PostgreSQL ã¨äº’æ›æ€§ãŒã‚ã‚Šã€SQL ã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€è‰²ã€…ãªæ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€SQL ã®å®Ÿè¡Œè¨ˆç”»ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãªã©ã€é–‹ç™ºåŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒå¤šãæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
safeql ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ PostgreSQL ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¾ã—ãŸã€‚
æœ¬å½“ã¯ PlanetScale ã‚’åˆ©ç”¨ã—ã¦ã¿ãŸã„ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€Hobby Plan ãŒçµ‚äº†ã—ã¦ã—ã¾ã£ãŸãŸã‚ã€ã“ã¡ã‚‰ã‚’é¸æŠã—ã¾ã—ãŸã€‚

### Clerk

https://clerk.dev/

IDaaS ã®èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ã®ç®¡ç†ã‚„æ“ä½œãŒç°¡å˜ã«ã§ãã€ã¾ãŸä»–ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æºã‚‚å®¹æ˜“ã§ã™ã€‚ã¾ãŸã€Hono ã¨ã®é€£æºãŒå¯èƒ½ã§ã™ã€‚
è‡ªåˆ†ã¯ä»¥å‰ Auth0 ã‚’åˆ©ç”¨ã—ã¦ã„ãŸã®ã§ã™ãŒã€ä¸€åº¦ Clerk ã‚’åˆ©ç”¨ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã€ä»Šå›ã¯ã“ã¡ã‚‰ã‚’é¸æŠã—ã¾ã—ãŸã€‚
å‰å›ã®æˆæ¥­å†…ãƒãƒƒã‚«ã‚½ãƒ³ã§ã¯è‡ªå‰ã§èªè¨¼ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã—ãŸãŒã€ä»Šå›ã¯ Clerk ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€èªè¨¼å‘¨ã‚Šã®å®Ÿè£…ã‚’æ¯”è¼ƒçš„ç°¡å˜ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

### React

https://react.dev/

ä½¿ã„æ…£ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä»Šå›ã‚‚ React ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

### Tanstack Router

https://tanstack.com/router/latest

å‰å›ã¨åŒã˜ãã€Tanstack Router ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚React ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Šã€å‹å®‰å…¨ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### Tanstack Query (React Query)

https://tanstack.com/query/latest

å‰å›ã¨åŒã˜ãã€Tanstack Query ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚React ã®ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Šã€åŠ¹ç‡åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### Tailwind CSS

https://tailwindcss.com/

Tailwind CSS ã‚’åˆ©ç”¨ã—ã¦ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è¡Œã„ã¾ã—ãŸã€‚

### shadcn/ui

https://ui.shadcn.com/

Tailwind CSS ã‚’åˆ©ç”¨ã—ã¦ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è¡Œã†ã“ã¨ã®å‡ºæ¥ã‚‹ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚å†…éƒ¨ã§ã¯ Radix UI ã¨å‘¼ã°ã‚Œã‚‹ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€ãƒ‡ã‚¶ã‚¤ãƒ³ã« Tailwind CSS ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### react-hot-toast

https://react-hot-toast.com/

é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ä»Šå›ã¯äºˆç´„ä½œæˆãƒ»å‰Šé™¤ã®éš›ã«é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¾ã—ãŸã€‚

### react-spinners

https://www.davidhu.io/react-spinners/

ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://github.com/calloc134/reserv-backend-lab/tree/master/db/migrations

ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚’ ER å›³ã«ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```mermaid
erDiagram
    room {
        uuid room_uuid PK
        text name
    }
    reservation {
        uuid reservation_uuid PK
        char(32) user_id
    }
    reservation_or_disabled {
        uuid rord_uuid PK
        uuid room_uuid FK
        status status
        uuid reservation_uuid FK
        date date
        slot slot
    }
    room ||--o{ reservation_or_disabled : contains
    reservation ||--o{ reservation_or_disabled : contains

```

ã“ã“ã§ã€ãƒ¦ãƒ¼ã‚¶ã®å†…å®¹ã«ã¤ã„ã¦ã¯ IDaaS ã§ã‚ã‚‹ Clerk ãŒç®¡ç†ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã«ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
ãƒ¦ãƒ¼ã‚¶ã«è¿”å´ã™ã‚‹æ®µéšã§ã€Clerk ã‹ã‚‰å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ä»˜ä¸ã—ã¦è¿”å´ã—ã¾ã™ã€‚

ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€

- room ãƒ†ãƒ¼ãƒ–ãƒ«
  - éƒ¨å±‹ã®æƒ…å ±ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«
- reservation_or_disabled
  - äºˆç´„æƒ…å ±ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«
  - status ãŒ `disabled` ã®å ´åˆã€ãã®æ—¥æ™‚ã¯äºˆç´„ä¸å¯
  - status ãŒ `reservation` ã®å ´åˆã€ãã®æ—¥æ™‚ã¯äºˆç´„çŠ¶æ…‹
- reservation
  - äºˆç´„æƒ…å ±ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«

ã“ã“ã§ã€äºˆç´„çŠ¶æ…‹ã¨äºˆç´„ä¸å¯çŠ¶æ…‹ã‚’ã¾ã¨ã‚ãŸè¨­è¨ˆã¯ã€ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

https://qiita.com/nunukim/items/49ad482544da0f622ec4

ã“ã®ã‚ˆã†ã«ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã‚’è¡Œã„ã¾ã—ãŸã€‚
ã¾ãŸã€ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã§ã¯ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä»¥ä¸‹ã®å››ç®‡æ‰€ã«æ–°è¦ã§è¨­å®šã—ã¦ã„ã¾ã™ã€‚

- user_id (reservation ãƒ†ãƒ¼ãƒ–ãƒ«)
- room_uuid (reservation_or_disabled ãƒ†ãƒ¼ãƒ–ãƒ«)
- reservation_uuid (reservation_or_disabled ãƒ†ãƒ¼ãƒ–ãƒ«)
- date, slot (reservation_or_disabled ãƒ†ãƒ¼ãƒ–ãƒ«)

ã“ã‚Œã‚’è¡Œã†ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒæœŸå¾…ã§ãã¾ã™(ãªãŠã€å®Ÿéš›ã¯ã‚ã‚“ã¾ã‚Šã†ã¾ãè¡Œã£ã¦ã„ã¾ã›ã‚“ãƒ»ãƒ»ãƒ»å¾Œè¿°ã—ã¾ã™)ã€‚

ãªãŠã€å½“è©² SQL ã¯ dbmate ã‚’ç”¨ã„ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
.env ã« DATABASE_URL ã‚’è¨­å®šã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
dbmate -e DATABASE_URL up
```

# safeql ãƒ«ãƒ¼ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ä»Šå› safeql ã‚’åˆ©ç”¨ã™ã‚‹ã«ã‚ãŸã£ã¦ã€ä¸‹æº–å‚™ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

safeql ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è‡ªåˆ†ã®ç’°å¢ƒã¯ Manjaro Linux ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã—ãŸã€‚

```bash
sudo pacman -S postgresql
```

æ¬¡ã«ã€PostgreSQL ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
sudo systemctl start postgresql
```

æ¬¡ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚

```bash
pnpm dbmate --url "postgresql://postgres@localhost:5432/reserv-keion?sslmode=disable" up
```

ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã€safeql ã®ãƒ«ãƒ¼ãƒ«ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

eslint.config.mjs ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
// @ts-check

import safeql from "@ts-safeql/eslint-plugin/config";
import tseslint from "typescript-eslint";

export default tseslint.config(
  ...tseslint.configs.recommendedTypeCheckedOnly,
  safeql.configs.connections({
    databaseUrl:
      "postgresql://postgres@localhost:5432/reserv-keion?sslmode=disable",
    targets: [{ wrapper: "pool.query" }],
  })
);
```

ã“ã®ãƒ«ãƒ¼ãƒ«ã§ã¯ã€pool.query ã«å¯¾ã—ã¦ SQL æ–‡ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```typescript
const result = await pool.query<{ name: string }>(
  sql`SELECT name FROM room WHERE uuid = ${room_uuid}`
);
```

æ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã¦ã„ã‚‹å ´åˆã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã«èµ¤ç·šãŒå¼•ã‹ã‚Œã€å‹ãŒææ¡ˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ã€ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](/images/c24167f2fb6921/2024-07-16-13-20-10.png)

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/calloc134/reserv-backend-lab

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

https://github.com/calloc134/reserv-backend-lab/blob/master/src/index.ts

ä»Šå›ã¯çŸ­ã„æœŸé–“ã§ã®é–‹ç™ºã§ã‚ã£ãŸãŸã‚ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ†å‰²ã›ãšã€ãƒãƒ³ãƒ‰ãƒ©ã«ã™ã¹ã¦å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚
ãŸã ã—ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã€é©åˆ‡ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¾

ä»Šå›ä½œæˆã—ãŸå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- NameValue
- UserIdValue
- UuidValue
- SlotValue

ãã‚Œãã‚Œã€åå‰ã€ãƒ¦ãƒ¼ã‚¶ IDã€UUIDã€ã‚¹ãƒ­ãƒƒãƒˆã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

:::details å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¾

```typescript
type NameValue = {
  name: string;
};

function newNameValue(name: string): Result<NameValue, Error> {
  if (name.length < 3) {
    return err(new Error("Name must be at least 3 characters long"));
  }

  if (name.length > 20) {
    return err(new Error("Name must be at most 20 characters long"));
  }

  return ok({ name });
}

type UserIdValue = {
  user_id: string;
};

function newUserIdValue(user_id: string): Result<UserIdValue, Error> {
  const userIdRegex = new RegExp(/^user_[A-Za-z0-9]+$/);
  if (!userIdRegex.test(user_id)) {
    return err(new Error("Invalid user id"));
  }
  return ok({ user_id });
}

type UuidValue = {
  uuid: string;
};

function createUuidValue(): UuidValue {
  const id = uuidv7();
  return { uuid: id };
}

function newUuidValue(uuid: string): Result<UuidValue, Error> {
  const uuidRegex = new RegExp(
    /^([0-9a-f]{8})-([0-9a-f]{4})-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i
  );
  if (!uuidRegex.test(uuid)) {
    return err(new Error("Invalid UUID"));
  }
  return ok({ uuid });
}

function convertToDate(date: string): Result<Date, Error> {
  // YYYY/MM/DD
  const [year, month, day] = date.split("-").map((x) => parseInt(x, 10));
  if (isNaN(year) || isNaN(month) || isNaN(day)) {
    return err(new Error("Invalid date"));
  }
  return ok(new Date(year, month - 1, day));
}

function convertFromDate(date: Date): string {
  const year = date.getFullYear();
  const month = date.getMonth() + 1;
  const day = date.getDate();
  return `${year}-${month}-${day}`;
}

type slot = "first" | "second" | "third" | "fourth";

type SlotValue = {
  slot: slot;
};

// Dateã¯Dateå‹ã§ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã§ä¸€æ—¦å®šç¾©ã—ãªã„ã“ã¨ã«

function newSlotValue(slot: slot): Result<SlotValue, Error> {
  if (
    slot !== "first" &&
    slot !== "second" &&
    slot !== "third" &&
    slot !== "fourth"
  ) {
    return err(new Error("Slot must be first, second, third or fourth"));
  }
  return ok({ slot });
}
```

:::

### Hono ã®åˆæœŸåŒ–

åˆæœŸåŒ–å‡¦ç†ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

```typescript
type Variables = {
  pool: Pool;
};

type Bindings = {
  DATABASE_URL: string;
  CLERK_SECRET_KEY: string;
  CLERK_PUBLISHABLE_KEY: string;
};

const app = new Hono<{
  Bindings: Bindings;
  Variables: Variables;
}>();
```

Variables å‹ã¨ Bindings å‹ã‚’å®šç¾©ã—ã€ãã‚Œã‚’åˆ©ç”¨ã—ã¦ Hono ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€env å¤‰æ•°ã«å‹ã‚’å®šç¾©ã—ã€å‹å®‰å…¨ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®å‡¦ç†ã§ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

```typescript
app.use("*", async (ctx, next) => {
  const pool = new Pool({
    connectionString: ctx.env.DATABASE_URL,
  });

  ctx.set("pool", pool);

  await next();
});
```

ã“ã®å‡¦ç†ã§ã¯ã€Neon Database ã®æä¾›ã™ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€ã“ã‚Œã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚»ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Clerk ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®š

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã€Clerk ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```typescript
app.use("*", async (ctx, next) => {
  const { CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY } = ctx.env;

  await clerkMiddleware({
    secretKey: CLERK_SECRET_KEY,
    publishableKey: CLERK_PUBLISHABLE_KEY,
  })(ctx, async () => {});

  const clerk_user = getAuth(ctx);
  if (!clerk_user || !clerk_user.userId) {
    console.debug("Unauthorized");
    return ctx.json({ message: "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚" }, 401);
  }

  await next();
});
```

Clerk ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å˜ä½“ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶èªè¨¼ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç¶šè¡Œã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã“ã‚Œã‚’æ‹¡å¼µã—ã€èªè¨¼ã«å¤±æ•—ã—ãŸå ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„æ—¨ã®ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©

ä»¥ä¸‹ã®æ§˜ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```typescript
type RoomResponse = {
  room_uuid: string;
  name: string;
};

type ReservationResponse = {
  rord_uuid: string;
  user: {
    user_id: string;
    name: string;
  } | null;
  room: {
    room_uuid: string;
    name: string;
  };
  slot: slot;
  date: string;
};
```

### å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å®Ÿè£…

ä»Šå›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ä¸€é€±é–“ä»¥å†…ã«è©²å½“ã™ã‚‹äºˆç´„ãŒã‚ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```typescript
function getMondayOfThisWeek(today: Date = new Date()): Date {
  // ã¾ãšæœ¬æ—¥ã®æ›œæ—¥ã‚’å–å¾—
  // ä»Šæ—¥ãŒå¹³æ—¥ã§ã‚ã‚Œã°ã€å‰ã®æœˆæ›œæ—¥ã‹ã‚‰æ¬¡ã®é‡‘æ›œæ—¥ã¾ã§ã®äºˆç´„ã‚’å–å¾—
  // ä»Šæ—¥ãŒä¼‘æ—¥ã§ã‚ã‚Œã°ã€æ¬¡ã®æœˆæ›œæ—¥ã‹ã‚‰é‡‘æ›œæ—¥ã¾ã§ã®äºˆç´„ã‚’å–å¾—
  // æœˆæ›œã•ãˆå–å¾—ã§ãã‚Œã°ã€ã‚ã¨ã¯+4æ—¥ã™ã‚Œã°é‡‘æ›œæ—¥ã«ãªã‚‹

  const day = today.getDay();

  let start_date: Date;

  if (day === 0) {
    // æ—¥æ›œæ—¥
    start_date = new Date(
      today.getFullYear(),
      today.getMonth(),
      today.getDate() + 1
    );
  } else if (day === 6) {
    // åœŸæ›œæ—¥
    start_date = new Date(
      today.getFullYear(),
      today.getMonth(),
      today.getDate() + 2
    );
  } else {
    // å¹³æ—¥ã§ã‚ã‚‹ãŸã‚ã€æœˆæ›œæ—¥ã‚’å–å¾—
    start_date = new Date(
      today.getFullYear(),
      today.getMonth(),
      today.getDate() - day + 1
    );
  }

  return start_date;
}
```

ã“ã®é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦ã€è©²å½“ã™ã‚‹æœˆæ›œæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ã—ã€ãã‚Œã‚’åŸºæº–ã«äºˆç´„ã®å–å¾—ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
(ãªãŠã€ã“ã®é–¢æ•°ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã¯ã‚ã¾ã‚Šåˆ©ç”¨ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚åŒã˜å†…å®¹ã®é–¢æ•°ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«è¨˜è¿°ã—ã¦ãŠã‚Šã€ãã¡ã‚‰ã§ä¸»ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚)

### ãƒãƒ³ãƒ‰ãƒ©ã¸ã®å‡¦ç†å®Ÿè£…

ã“ã“ã§ã¯è‰²ã€…ãªãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè£…ã—ã¾ã—ãŸãŒã€ç‰¹ã«äºˆç´„ã®å–å¾—ãƒ»ä½œæˆãƒ»å‰Šé™¤ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

#### äºˆç´„ã®å–å¾—

äºˆç´„ã®å–å¾—ã§ã¯ã€é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚Šã€ãã®ç¯„å›²å†…ã®äºˆç´„ã‚’å–å¾—ã—ã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

:::details äºˆç´„ã®å–å¾—

```typescript
app.get(
  "/reservations/start_date/:start_date/end_date/:end_date/",
  vValidator(
    "param",
    object({ start_date: string(), end_date: string() }),
    (result, ctx) => {
      if (!result.success) {
        return ctx.json({ message: "Invalid request" }, 400);
      }
    }
  ),

  async (ctx) => {
    const pool = ctx.get("pool");

    const clerkClient = createClerkClient({
      secretKey: ctx.env.CLERK_SECRET_KEY,
      publishableKey: ctx.env.CLERK_PUBLISHABLE_KEY,
    });

    const start_date_result = convertToDate(ctx.req.valid("param").start_date);
    const end_date_result = convertToDate(ctx.req.valid("param").end_date);

    if (start_date_result.isErr() || end_date_result.isErr()) {
      return ctx.json({ message: "Invalid date" }, 400);
    }

    const start_date = start_date_result.value;
    const end_date = end_date_result.value;

    // room_nameãŒnullã«ãªã‚‹å ´åˆãŒã‚ã‚‹ã®ãªã‚“ã§ã ã‚ã†
    const result = await pool.query<{
      rord_uuid: string;
      room_uuid: string;
      room_name: string;
      status: "reserved" | "disabled";
      date: Date;
      slot: "first" | "second" | "third" | "fourth";
      user_id: string | null;
    }>(
      sql`
			SELECT 
				rod.rord_uuid,
				rod.room_uuid,
				room.name as room_name,
				rod.status,
				rod.date,
				rod.slot,
				CASE 
					WHEN rod.status = 'reserved' THEN res.user_id
					ELSE NULL
				END AS user_id
			FROM 
				reservation_or_disabled rod
			INNER JOIN
				room
			ON
				rod.room_uuid = room.room_uuid
			LEFT JOIN 
				reservation res 
			ON 
				rod.reservation_uuid = res.reservation_uuid
			WHERE 
				rod.date >= ${start_date} AND rod.date <= ${end_date}
			ORDER BY 
				rod.date, 
				rod.slot;
	`
    );

    // if (result.rows.length === 0) {
    // 	return ctx.json({ message: 'No reservations' }, 404);
    // }

    const response: ReservationResponse[] = [];

    const users = await clerkClient.users.getUserList({
      userId: result.rows
        .map((row) => row.user_id)
        .filter((x): x is string => x !== null),
    });

    for (const row of result.rows) {
      const rord_uuid_result = newUuidValue(row.rord_uuid);
      if (rord_uuid_result.isErr()) {
        throw new Error("Invalid UUID");
      }

      const room_uuid_result = newUuidValue(row.room_uuid);
      if (room_uuid_result.isErr()) {
        throw new Error("Invalid UUID");
      }

      const slot_result = newSlotValue(row.slot as slot);
      if (slot_result.isErr()) {
        throw new Error("Invalid slot");
      }

      const date = row.date;

      const user =
        row.user_id === null
          ? null
          : users.data.find((user) => user.id === row.user_id);

      response.push({
        rord_uuid: rord_uuid_result.value.uuid,
        room: {
          room_uuid: room_uuid_result.value.uuid,
          name: row.room_name,
        },
        slot: slot_result.value.slot,
        date: convertFromDate(date),
        user:
          user === null
            ? null
            : {
                user_id: user?.id ?? "",
                name:
                  user?.firstName || user?.lastName
                    ? `${user?.firstName} ${user?.lastName}`
                    : "",
              },
      });
    }
    return ctx.json({
      start_date: convertFromDate(start_date),
      end_date: convertFromDate(end_date),
      reservations: response,
    });
  }
);
```

:::

ã¾ãšæœ€åˆã«ã€Hono ãŒæä¾›ã—ã¦ã„ã‚‹ valibot ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å‹å®‰å…¨ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã«ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ—¥æ™‚ã‚’å–å¾—ã—ã€ãã®æ—¥æ™‚ã‚’åŸºæº–ã« SQL æ–‡ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚
SQL ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

```sql

SELECT
      rod.rord_uuid,
      rod.room_uuid,
      room.name as room_name,
      rod.status,
      rod.date,
      rod.slot,
      CASE
        WHEN rod.status = 'reserved' THEN res.user_id
        ELSE NULL
      END AS user_id
    FROM
      reservation_or_disabled rod
    INNER JOIN
      room
    ON
      rod.room_uuid = room.room_uuid
    LEFT JOIN
      reservation res
    ON
      rod.reservation_uuid = res.reservation_uuid
    WHERE
      rod.date >= ${start_date} AND rod.date <= ${end_date}
    ORDER BY
      rod.date,
      rod.slot;
```

ã“ã® SQL æ–‡ã§ã¯ã€äºˆç´„ã‚‚ã—ãã¯äºˆç´„ä¸å¯ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã€æŒ‡å®šã•ã‚ŒãŸæ—¥æ™‚ã®ç¯„å›²å†…ã®äºˆç´„ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
ãã®å¾Œã€ã‚‚ã—äºˆç´„çŠ¶æ…‹ãŒäºˆç´„ã§ã‚ã‚Œã°ã€äºˆç´„ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ LEFT JOIN ã§çµåˆã—ã€ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€éƒ¨å±‹ã«ã¤ã„ã¦ã¯ã‹ãªã‚‰ãšå­˜åœ¨ã™ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€INNER JOIN ã§çµåˆã—ã¦ã„ã¾ã™ã€‚
ãªãŠã€ã“ã®çµæœã¯æ—¥æ™‚ã¨ã‚¹ãƒ­ãƒƒãƒˆã§ã‚½ãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã‚Œã«å¯¾ã—ã€safeql ãŒç”Ÿæˆã—ãŸå‹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

```typescript
{
  rord_uuid: string;
  room_uuid: string;
  room_name: string;
  status: "reserved" | "disabled";
  date: Date;
  slot: "first" | "second" | "third" | "fourth";
  user_id: string | null;
}
```

ã“ã®ã‚ˆã†ã«ã€LEFT JOIN ã§çµåˆã—ãŸéƒ¨åˆ†ã¯ null ã‚’è¨±å®¹ã—ã€INNER JOIN ã§çµåˆã—ãŸéƒ¨åˆ†ã¯ null ã‚’è¨±å®¹ã—ãªã„ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€é©åˆ‡ã«å‹ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã¾ãŸã€user_id ã«ã¤ã„ã¦ã€Clerk ã®ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã¨çµåˆã•ã›ã‚‹ãŸã‚ã€Clerk ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```typescript
const users = await clerkClient.users.getUserList({
  userId: result.rows
    .map((row) => row.user_id)
    .filter((x): x is string => x !== null),
});
```

ã“ã®ã‚ˆã†ã«ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã—ã€ãã‚Œã‚’å…ƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

### äºˆç´„ã®ä½œæˆ

äºˆç´„ã®ä½œæˆã§ã¯ã€éƒ¨å±‹ã® UUIDã€æ—¥æ™‚ã€ã‚¹ãƒ­ãƒƒãƒˆã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚Šã€ãã®äºˆç´„ã‚’ä½œæˆã—ã¾ã™ã€‚

:::details äºˆç´„ã®ä½œæˆ

```typescript
app.post(
  "/reservations/",
  vValidator(
    "json",
    object({
      room_uuid: string(),
      slot: string(),
      date: string(),
      // user_id: string(),
    }),
    (result, ctx) => {
      if (!result.success) {
        return ctx.json({ message: "Invalid request" }, 400);
      }
    }
  ),

  async (ctx) => {
    const pool = ctx.get("pool");

    const {
      room_uuid: raw_room_uuid,
      slot: raw_slot,
      date: raw_date,
    } = ctx.req.valid("json");

    const room_uuid_result = newUuidValue(raw_room_uuid);
    if (room_uuid_result.isErr()) {
      return ctx.json({ message: "Invalid room_uuid" }, 400);
    }

    const slot_result = newSlotValue(raw_slot as slot);
    if (slot_result.isErr()) {
      return ctx.json({ message: "Invalid slot" }, 400);
    }

    // è©²å½“ã™ã‚‹æ—¥ã«ã¡ã®ä¸€é€±é–“ã«ã¤ã„ã¦å–å¾—
    const date = new Date(raw_date);

    // ã¾ãšã€æœ¬æ—¥ã‚ˆã‚Šå‰ã®æ—¥ä»˜ã§ã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼
    if (date < new Date()) {
      return ctx.json({ message: "éå»ãƒ»å½“æ—¥ã®æ—¥ä»˜ã¯äºˆç´„ã§ãã¾ã›ã‚“ã€‚" }, 400);
    }

    // å¿µã®ç‚ºã€å¹³æ—¥ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    if (date.getDay() === 0 || date.getDay() === 6) {
      return ctx.json({ message: "Invalid date" }, 400);
    }

    const start_date = getMondayOfThisWeek(date);
    const end_date = new Date(
      start_date.getFullYear(),
      start_date.getMonth(),
      start_date.getDate() + 4
    );

    // äºˆç´„ãŒåŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ç¢ºèª
    const result = await pool.query<{ count: number }>(
      sql`
				SELECT count(*)::int FROM reservation_or_disabled WHERE room_uuid = ${room_uuid_result.value.uuid}::uuid AND date = ${date} AND slot = ${slot_result.value.slot}::slot;
			`
    );

    if (result.rows[0].count !== 0) {
      return ctx.json({ message: "ã™ã§ã«äºˆç´„ãŒåŸ‹ã¾ã£ã¦ã„ã¾ã™ã€‚" }, 400);
    }

    // è‡ªåˆ†ãŒä¸€é€±é–“ä»¥å†…ã«äºˆç´„ã—ã¦ã„ã‚‹ã‹ç¢ºèª
    // const user_id = 'user_2cSSCzV7948rhPJMsY601tXsEU4';
    const clerk_user = getAuth(ctx);

    if (!clerk_user || !clerk_user.userId) {
      return ctx.json({ message: "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚" }, 401);
    }

    const user_id_result = newUserIdValue(clerk_user.userId);

    if (user_id_result.isErr()) {
      return ctx.json({ message: "Invalid user_id" }, 400);
    }

    const result_2 = await pool.query<{ count: number }>(
      sql`
				SELECT count(*)::int FROM reservation_or_disabled rod
				LEFT JOIN reservation res ON rod.reservation_uuid = res.reservation_uuid
				WHERE res.user_id = ${user_id_result.value.user_id}::text AND rod.date >= ${start_date} AND rod.date <= ${end_date};
			`
    );

    if (result_2.rows[0].count !== 0) {
      return ctx.json({ message: "ä¸€é€±é–“ä»¥å†…ã«äºˆç´„ã—ã¦ã„ã¾ã™ã€‚" }, 400);
    }

    const reservation_or_disabled_uuid = createUuidValue();
    const reservation_uuid = createUuidValue();

    const result_3 = await pool.query<{ reservation_uuid: string }>(
      sql`
				INSERT INTO reservation (reservation_uuid, user_id) VALUES (${reservation_uuid.uuid}::uuid, ${user_id_result.value.user_id}::text) RETURNING reservation_uuid;
			`
    );

    if (result_3.rows.length !== 1) {
      return ctx.json({ message: "Failed to insert" }, 500);
    }

    const result_4 = await pool.query<{ rord_uuid: string }>(
      sql`
				INSERT INTO reservation_or_disabled (rord_uuid, room_uuid, date, slot, status, reservation_uuid) VALUES
				(${reservation_or_disabled_uuid.uuid}::uuid, ${room_uuid_result.value.uuid}::uuid, ${date}, ${slot_result.value.slot}::slot, 'reserved', ${reservation_uuid.uuid}::uuid) RETURNING rord_uuid;
			`
    );

    if (result_4.rows.length !== 1) {
      return ctx.json({ message: "Failed to insert" }, 500);
    }

    return ctx.json({ message: "äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸã€‚" });
  }
);
```

:::

ã¾ãšã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã€ãã®å¾Œã€éƒ¨å±‹ã® UUID ã¨ã‚¹ãƒ­ãƒƒãƒˆã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¶ç´„ã«é•åã—ã¦ã„ãªã„ã‹ã‚’é †æ¬¡ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

- éå»ãƒ»å½“æ—¥ã®æ—¥ä»˜ã§ãªã„ã“ã¨
- å¹³æ—¥ã§ã‚ã‚‹ã“ã¨
- äºˆç´„ãŒåŸ‹ã¾ã£ã¦ã„ãªã„ã“ã¨
- è‡ªåˆ†ãŒä¸€é€±é–“ä»¥å†…ã«äºˆç´„ã—ã¦ã„ãªã„ã“ã¨

ã“ã‚Œã‚‰ã®æ¡ä»¶ã«é•åã—ã¦ã„ãªã„å ´åˆã€äºˆç´„ã‚’ä½œæˆã—ã¾ã™ã€‚

ã“ã“ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ SQL æ–‡ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

```sql
SELECT count(*)::int FROM reservation_or_disabled rod
LEFT JOIN reservation res ON rod.reservation_uuid = res.reservation_uuid
WHERE res.user_id = ${user_id_result.value.user_id}::text AND rod.date >= ${start_date} AND rod.date <= ${end_date};
```

```sql
INSERT INTO reservation (reservation_uuid, user_id) VALUES (${reservation_uuid.uuid}::uuid, ${user_id_result.value.user_id}::text) RETURNING reservation_uuid;
INSERT INTO reservation_or_disabled (rord_uuid, room_uuid, date, slot, status, reservation_uuid) VALUES
(${reservation_or_disabled_uuid.uuid}::uuid, ${room_uuid_result.value.uuid}::uuid, ${date}, ${slot_result.value.slot}::slot, 'reserved', ${reservation_uuid.uuid}::uuid) RETURNING rord_uuid;
```

ã“ã®ã‚ˆã†ã«ã—ã¦ã€äºˆç´„ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

### äºˆç´„ã®å‰Šé™¤

äºˆç´„ã®å‰Šé™¤ã§ã¯ã€äºˆç´„ã® UUID ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚Šã€ãã®äºˆç´„ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

:::details äºˆç´„ã®å‰Šé™¤

```typescript
app.delete(
  "/reservations/:rord_uuid/",
  vValidator("param", object({ rord_uuid: string() }), (result, ctx) => {
    if (!result.success) {
      return ctx.json({ message: "Invalid request" }, 400);
    }
  }),

  async (ctx) => {
    const pool = ctx.get("pool");

    const rord_uuid_result = newUuidValue(ctx.req.valid("param").rord_uuid);

    if (rord_uuid_result.isErr()) {
      return ctx.json({ message: "Invalid rord_uuid" }, 400);
    }

    const result = await pool.query<{
      status: "reserved" | "disabled";
      date: Date;
      user_id: string | null;
    }>(
      sql`
				SELECT rod.status, rod.date, res.user_id FROM reservation_or_disabled rod LEFT JOIN reservation res ON rod.reservation_uuid = res.reservation_uuid WHERE rod.rord_uuid = ${rord_uuid_result.value.uuid}::uuid;
			`
    );

    if (result.rows.length !== 1) {
      return ctx.json({ message: "å¯¾å¿œã™ã‚‹äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚" }, 404);
    }

    if (
      result.rows[0].status !== "reserved" ||
      result.rows[0].user_id === null
    ) {
      return ctx.json({ message: "äºˆç´„ã§ã¯ãªãã€åˆ©ç”¨ç¦æ­¢ã®æ—¥æ™‚ã§ã™ã€‚" }, 400);
    }

    const clerk_user = getAuth(ctx);

    if (!clerk_user || !clerk_user.userId) {
      return ctx.json({ message: "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚" }, 401);
    }

    const clerk_user_id_result = newUserIdValue(clerk_user.userId);

    if (clerk_user_id_result.isErr()) {
      return ctx.json({ message: "Invalid user_id" }, 400);
    }

    if (result.rows[0].user_id !== clerk_user_id_result.value.user_id) {
      return ctx.json(
        { message: "ä»–ã®ãƒ¦ãƒ¼ã‚¶ã®äºˆç´„ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã¾ã›ã‚“ã€‚" },
        403
      );
    }

    if (result.rows[0].date === null) {
      return ctx.json({ message: "Invalid date" }, 400);
    }

    const date = result.rows[0].date;

    const now = new Date();

    if (date.getTime() - now.getTime() < 3 * 24 * 60 * 60 * 1000) {
      return ctx.json(
        { message: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯3æ—¥ä»¥ä¸Šå…ˆã®äºˆç´„ã®ã¿å¯èƒ½ã§ã™ã€‚" },
        400
      );
    }

    const result_2 = await pool.query<{ rord_uuid: string }>(
      // sql`
      // 	DELETE FROM reservation_or_disabled WHERE rord_uuid = ${rord_uuid_result.value.uuid}::uuid RETURNING rord_uuid;
      // `
      sql` DELETE FROM reservation USING reservation_or_disabled WHERE reservation.reservation_uuid = reservation_or_disabled.reservation_uuid AND reservation_or_disabled.rord_uuid = ${rord_uuid_result.value.uuid}::uuid RETURNING rord_uuid;`
    );

    // cascadeãªã®ã§reservationã‚‚æ¶ˆãˆã‚‹
    // ã“ã®ã‚„ã‚Šæ–¹ãŒå¥½ã¾ã—ã„ã‹ã¯ã‚ã‹ã‚‰ãªã„ã€‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒRDBMSã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚‹ãŒã€ãã‚‚ãã‚‚ã“ã†ã„ã†éœ€è¦ãŒã‚ã‚‹ãŸã‚ã«è¿½åŠ ã•ã‚ŒãŸæ©Ÿèƒ½ã§ã‚ã‚‹æ°—ã‚‚ã™ã‚‹ã€‚

    if (result_2.rows.length !== 1) {
      return ctx.json({ message: "Failed to delete" }, 500);
    }

    return ctx.json({ message: "äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚" });
  }
);
```

:::

ã¾ãšã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã€ãã®å¾Œã€äºˆç´„ã® UUID ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¶ç´„ã«é•åã—ã¦ã„ãªã„ã‹ã‚’é †æ¬¡ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

- äºˆç´„ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
- äºˆç´„ã§ã‚ã‚‹ã“ã¨
- è‡ªåˆ†ã®äºˆç´„ã§ã‚ã‚‹ã“ã¨
- 3 æ—¥ä»¥ä¸Šå…ˆã®äºˆç´„ã§ã‚ã‚‹ã“ã¨

ã“ã‚Œã‚‰ã®æ¡ä»¶ã«é•åã—ã¦ã„ãªã„å ´åˆã€äºˆç´„ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

ã“ã“ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ SQL æ–‡ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

```sql
SELECT rod.status, rod.date, res.user_id FROM reservation_or_disabled rod LEFT JOIN reservation res ON rod.reservation_uuid = res.reservation_uuid WHERE rod.rord_uuid = ${rord_uuid_result.value.uuid}::uuid;
```

```sql
DELETE FROM reservation USING reservation_or_disabled WHERE reservation.reservation_uuid = reservation_or_disabled.reservation_uuid AND reservation_or_disabled.rord_uuid = ${rord_uuid_result.value.uuid}::uuid RETURNING rord_uuid;
```

ã“ã®ã‚ˆã†ã«ã—ã¦ã€äºˆç´„ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™ã€‚

ãªãŠã€äºˆç´„ä¸å¯è¨­å®šã«ã¤ã„ã¦ã¯å®Ÿè£…ã‚’è¡Œã„ã¾ã—ãŸãŒã€admin ãƒ¦ãƒ¼ã‚¶ã®å‡¦ç†ã«ã¤ã„ã¦ã¯ã¾ã å®Ÿè£…ãŒå‡ºæ¥ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ä»Šå¾Œã®èª²é¡Œã¨ã—ã¦ã„ã¾ã™ã€‚

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…ã¯ä»¥ä¸Šã§ã™ã€‚

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/calloc134/reserv-frontend-lab

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ†å‰²ã‚’è¡Œã„ã€è¨˜è¿°ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```
src
â”œâ”€â”€ components
â”œâ”€â”€ pages
â”œâ”€â”€ hooks
â”œâ”€â”€ utils
â”œâ”€â”€ types
â”œâ”€â”€ main.tsx
â””â”€â”€ route.tsx
```

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

ã¾ãšã€route.tsx ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

https://github.com/calloc134/reserv-frontend-lab/blob/main/src/route.tsx

èªè¨¼ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒˆã«ã¯ useEffect ã§èªè¨¼ã‚’è¡Œã„ã€èªè¨¼ãŒã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€Tanstack Query ã§ Suspense ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã€Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å¢ƒç•Œã‚’è¨­å®šã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚

:::message
æ€ã£ãŸã“ã¨

- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ‡ã‚Šå‡ºã—ã¦ã‚‚è‰¯ã‹ã£ãŸã‹ã‚‚ï¼Ÿ
  :::

```typescript
const home_route = createRoute({
  getParentRoute: () => rootRoute,
  path: "/home",
  component: () => {
    const { isSignedIn, isLoaded } = useAuth();

    const navigate = useNavigate();

    // èªè¨¼ã®åˆ¤å®š
    useEffect(() => {
      if (!isSignedIn && isLoaded) {
        toast.error("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„");
        // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        navigate({
          to: "/",
        });
      }
    }, [isSignedIn, navigate]);

    return (
      <HomeLayout>
        <Suspense
          fallback={
            <div className="flex h-screen justify-top items-center flex-col gap-4">
              <div className="flex w-1/2  flex-row gap-4 justify-center">
                <div className="p-2 rounded-lg border-2 border-black w-1/2 text-center bg-gray-200">
                  äºˆç´„ä¸€è¦§(é€±)
                </div>
                <div className="p-2 rounded-lg border-2 border-black w-1/2 text-center bg-gray-200">
                  è‡ªåˆ†ã®äºˆç´„ä¸€è¦§(é€±)
                </div>
              </div>
              <div className="p-16 bg-white rounded-lg col-span-1 sm:col-span-2 md:col-span-2 border-2 border-black">
                <ClipLoader color="#000" loading={true} size={50} />
              </div>
            </div>
          }
        >
          <Outlet />
        </Suspense>
      </HomeLayout>
    );
  },
});
```

### ãƒšãƒ¼ã‚¸

ä»Šå›å®Ÿè£…ã—ãŸãƒšãƒ¼ã‚¸ã¯ã€

- ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
- ã™ã¹ã¦ã®äºˆç´„ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸
- è‡ªåˆ†ã®äºˆç´„ã‚’ç¢ºèªã™ã‚‹ãƒšãƒ¼ã‚¸
  ã® 3 ã¤ã§ã™ã€‚

#### ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸

Clerk ã¯ SignIn ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã—ã¦ãŠã‚Šã€ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```typescript
import { SignIn } from "@clerk/clerk-react";

export const LoginPage = () => {
  return (
    <div className="flex flex-col items-center justify-center h-screen p-4">
      <SignIn
        fallbackRedirectUrl={
          import.meta.env.VITE_APP_PATH
            ? import.meta.env.VITE_APP_PATH + "/home"
            : "/home"
        }
      />
    </div>
  );
};
```

ã“ã“ã§ã€å°†æ¥çš„ã«ç›¸å¯¾ãƒ‘ã‚¹ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€ import.meta.env.VITE_APP_PATH ã‚’èª­ã¿è¾¼ã‚“ã§ãƒ‘ã‚¹ã‚’çµåˆã—ã¦ã„ã¾ã™ã€‚

#### äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸

https://github.com/calloc134/reserv-frontend-lab/blob/main/src/pages/WeeklyReservations.tsx

#### è‡ªåˆ†ã®äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸

https://github.com/calloc134/reserv-frontend-lab/blob/main/src/pages/WeeklyMyReservations.tsx

ãã‚Œãã‚Œã€äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã¨ã€è‡ªåˆ†ã®äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã§ã™ã€‚

ã‚µãƒ¼ãƒã®ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã®ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¯ suspense ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¯å…ˆç¨‹ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã“ã“ã§ã€ã‚µãƒ¼ãƒã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å½¢å¼ã§ã¯ãªã„ãŸã‚ã€è¦‹ãŸç›®ã‚’æ•´ãˆã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚’ä½œæˆã—ã€åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://github.com/calloc134/reserv-frontend-lab/blob/main/src/utils/createTable.ts

ã¾ãŸã€äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸ã§ã¯äºˆç´„ã®å‰Šé™¤ã€è‡ªåˆ†ã®äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸ã§ã¯è‡ªåˆ†ã®äºˆç´„å‰Šé™¤ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

æ­£ç›´ã€pages ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã‹ãªã‚Šå¤§è¦æ¨¡ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚ä»Šå¾Œç¶™ç¶šçš„ã«é–‹ç™ºã™ã‚‹å ´åˆã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é©åˆ‡ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚

:::message
æ€ã£ãŸã“ã¨

- ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã§æœ€åˆã‹ã‚‰ã‚„ã‚Œã°ã‚ˆã‹ã£ãŸã‹ã‚‚ãƒ»ãƒ»ãƒ»
- mutateAsync ã§ Promise å®Ÿè¡Œã™ã‚‹ã®ã§ã‚ã‚Œã°æœ€åˆã‹ã‚‰ useMutation ã˜ã‚ƒãªãã¦ã„ã„ã‹ã‚‚
  :::

ãã‚Œãã‚Œã®ãƒšãƒ¼ã‚¸ã§ã¯ Tanstack Router ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã€å‚ç…§ã—ã¦ã„ã‚‹é€±ãŒå…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…ã¯ä»¥ä¸Šã§ã™ã€‚

# æ„Ÿæƒ³ã¨å°è±¡ã«æ®‹ã£ãŸã“ã¨

## safeql ã®ä½¿ã„å‹æ‰‹ãŒè‰¯ã‹ã£ãŸ

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã§ã¯ã€ORM æ´¾ã¨ SQL ç›´æ¥è¨˜è¿°æ´¾ã®é–“ã§è­°è«–ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ORM æ´¾ã¯ SQL ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ãªãã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¨˜è¿°ã§ãã‚‹ã“ã¨ãƒ»TypeScript ã§ã‚ã‚Œã°å‹å®‰å…¨ã«è¨˜è¿°ã§ãã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¾ã™ã€‚åé¢ã€SQL ã®è¡¨ç¾åŠ›ã‚’ååˆ†ã«åˆ©ç”¨ã§ããªã„ã“ã¨ã‚„ã€SQL ã‚’ç›´æ¥è¨˜è¿°ã§ããªã„ã“ã¨ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒä»˜éšã—ã€ä½•ã‚ˆã‚Š SQL ã®çŸ¥è­˜ãŒãŠã‚ãã‹ã«ãªã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒç™ºç”Ÿã—ãŸéš›ã«å¯¾å‡¦ã§ããªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

SQL ç›´æ¥è¨˜è¿°æ´¾ã¯ã€SQL ã®è¡¨ç¾åŠ›ã‚’æœ€å¤§é™ã«æ´»ã‹ã™ã“ã¨ãŒã§ãã‚‹ã“ã¨ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œã«å¯¾å‡¦ã§ãã‚‹ã“ã¨ã€SQL ã®çŸ¥è­˜ãŒã‚ã‚Œã°ã©ã®ã‚ˆã†ãªå•é¡Œã«ã‚‚å¯¾å‡¦ã§ãã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¾ã™ã€‚åé¢ã€SQL ã®è¨˜è¿°ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§è¨˜è¿°ã™ã‚‹éš›ã«å‹å®‰å…¨ãŒã‚ã¾ã‚Šä¿è¨¼ã•ã‚Œãšã€é–‹ç™ºè€…ä½“é¨“ãŒæ‚ªã„ã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä¸–ç•Œã§ã¯ä¸¡è€…ã¨ã‚‚ã«è¿‘å¹´ã§ã¯æ­©ã¿å¯„ã‚ŠãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ä¾‹ã‚’ä¸Šã’ã‚‹ã¨ã€Drizzle ORM ã®ã‚ˆã†ã«ã‚ˆã‚Šã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã«è¿‘ã„ ORM ãŒç™»å ´ã—ã¦ããŸã‚Šã€sqlc ã®ã‚ˆã†ã«è¨˜è¿°ã—ãŸ SQL ã‹ã‚‰å‹ã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒç™»å ´ã—ã¦ããŸã‚Šã—ã¦ã„ã¾ã™ã€‚

https://qiita.com/tsukasaI/items/bbfac8f4319981d2bcaf
https://future-architect.github.io/articles/20210804a/

safeql ã¯ã€SQL ç›´æ¥è¨˜è¿°ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã¨ã‚ŠãªãŒã‚‰ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«ä¾å­˜ã™ã‚‹ã®ã§ã¯ãªãã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® SQL ã‚’è¨˜è¿°ã—ãªãŒã‚‰å‹ã‚’ç”Ÿæˆã§ãã‚‹ã¨ã„ã£ãŸç‚¹ãŒéå¸¸ã«æ–°ã—ãã€é­…åŠ›çš„ã§ã‚ã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€SQL ã¸ã®ç†è§£ã‚’æ·±ã‚ãªãŒã‚‰å‹å®‰å…¨ã§é–‹ç™ºè€…ä½“é¨“ã®è‰¯ã„é–‹ç™ºã‚’ã‚„ã‚Šé‚ã’ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚

## Clerk ã®ä½¿ã„å‹æ‰‹ãŒè‰¯ã‹ã£ãŸ

Clerk ã«ã¤ã„ã¦ã¯åˆã‚ã¦åˆ©ç”¨ã—ã¾ã—ãŸã€‚ä½¿ã„å‹æ‰‹ã¨ã—ã¦ã¯ Auth0 ã®å ´åˆã¨åŒã˜æ§˜ã«åˆ©ç”¨ã§ãã¾ã—ãŸã€‚Cloudflare Workers ã‹ã‚‰å‘¼ã³å‡ºã—ãŒã§ãã‚‹ã‹æœ€åˆä¸å®‰ã§ã—ãŸãŒã€å…¬å¼ã® Middleware ãŒã¡ã‚ƒã‚“ã¨å‹•ãã‚ˆã†ã§ã€é–‹ç™ºè€…ä½“é¨“ã‚‚éå¸¸ã«è‰¯ã‹ã£ãŸã§ã™ã€‚
ã¾ãŸã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦åŸ‹ã‚è¾¼ã¿ãŒå‡ºæ¥ã‚‹ç‚¹ã‚‚è‰¯ã‹ã£ãŸã§ã™ã€‚

## Neon Database ãŒä¾¿åˆ©

Neon Database ã«ã¤ã„ã¦ã‚‚åˆã‚ã¦åˆ©ç”¨ã—ã¾ã—ãŸã€‚ç®¡ç†ç”»é¢ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”»é¢ã‚‚æ•´ã£ã¦ãŠã‚Šã€SQL ã®å®Ÿè¡Œè¨ˆç”»ã‚‚ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã§ç¢ºèªã§ãã‚‹ã®ã¯éå¸¸ã«ä¾¿åˆ©ã ã¨æ„Ÿã˜ã¾ã—ãŸã€‚

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è²¼ã£ã¦ã¿ãŸã‘ã©ã‚ã¾ã‚ŠåŠ¹ç‡çš„ã«ãªã‚‰ãªã‹ã£ãŸ

ä»Šå›ã¯ SQL ã§ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ãŸãŸã‚ã€ã›ã£ã‹ããªã®ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é©åˆ‡ã«è²¼ã‚Šé«˜é€ŸåŒ–ã‚’è€ƒãˆã¾ã—ãŸã€‚è²¼ã£ãŸç®‡æ‰€ã«ã¤ã„ã¦ã¯å‰è¿°ã®ã¨ãŠã‚Šãªã®ã§ã™ãŒã€å®Ÿéš›ã«ã¯ã‚ã¾ã‚ŠåŠ¹æœãŒãªã‹ã£ãŸã‚ˆã†ã«æ„Ÿã˜ã¾ã—ãŸã€‚

```sql
explain ANALYZE SELECT rod.status, rod.date, res.user_id FROM reservation_or_disabled rod LEFT JOIN reservation res ON rod.reservation_uuid = res.reservation_uuid WHERE rod.reservation_uuid = 'xxxxxxxx-258b-7b82-a30b-fd2056ffa49d'::uuid;
```

```
Nested Loop Left Join  (cost=0.00..2.40 rows=1 width=140) (actual time=0.015..0.017 rows=1 loops=1)
  ->  Seq Scan on reservation_or_disabled rod  (cost=0.00..1.21 rows=1 width=24) (actual time=0.009..0.011 rows=1 loops=1)
        Filter: (reservation_uuid = '01909c95-258b-7b82-a30b-fd2056ffa49d'::uuid)
        Rows Removed by Filter: 16
  ->  Seq Scan on reservation res  (cost=0.00..1.18 rows=1 width=148) (actual time=0.004..0.004 rows=1 loops=1)
        Filter: (reservation_uuid = '01909c95-258b-7b82-a30b-fd2056ffa49d'::uuid)
Planning Time: 0.308 ms
Execution Time: 0.038 ms
```

é©å½“ãªã‚¯ã‚¨ãƒªã‚’ä¸€ã¤è©¦ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
RDBMS ä½•ã‚‚ã‚ã‹ã‚‰ã‚“ãƒ»ãƒ»ãƒ»

# ã¾ã¨ã‚

ä»Šå›ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸¡æ–¹ã‚’å®Ÿè£…ã—ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚
åˆã‚ã¦åˆ©ç”¨ã™ã‚‹æŠ€è¡“ã‚‚å¤šã‹ã£ãŸãŸã‚ã€æŒ‘æˆ¦ã™ã‚‹ç®‡æ‰€ã‚‚å¤šã‹ã£ãŸã§ã™ãŒã€è‰¯ã„çµŒé¨“ã¨ãªã‚Šã¾ã—ãŸã€‚
ä»Šå¾Œç¶™ç¶šé–‹ç™ºã—ã¦ã„ãéš›ã«ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²ã‚„ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ©Ÿèƒ½è¿½åŠ ãªã©ã‚’è¡Œã£ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
