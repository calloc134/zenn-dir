---
title: "TanStack Routerã§ã‚µã‚¯ãƒƒã¨å§‹ã‚ã‚‹å‹å®‰å…¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"
emoji: "ğŸŒ´"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "typescript", "tanstackrouter", "å‹å®‰å…¨", "tanstackquery"]
published: true
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚calloc134 ã§ã™ã€‚

è‡ªåˆ†ã¯æ™®æ®µ React ã‚’åˆ©ç”¨ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é–‹ç™ºã‚’ã—ã¦ã„ã¾ã™ã€‚
SPA ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹ä¸Šã§ã€TanStack Router ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

ã“ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã€ç°¡å˜ã«ã¾ã¨ã¾ã£ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ€ã£ãŸã‚ˆã‚Šå°‘ãªãæ„Ÿã˜ãŸãŸã‚ã€ã¾ã¨ã‚ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## TanStack Router ã¨ã¯

TanStack Router ã¯ã€React ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
å½“åˆã¯ React Location ã¨ã—ã¦ã€TanStack ã® Tanner Linsley æ°ã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚
https://dev.classmethod.jp/articles/intro-react-location/

ãã®å¾Œã€æ”¹åã‚„è¨­è¨ˆã®ã—ç›´ã—ãŒè¡Œã‚ã‚Œã€TanStack Router ã¨ã—ã¦é–‹ç™ºã•ã‚Œã¦ãŠã‚Šã€2023 å¹´ã®ã‚¯ãƒªã‚¹ãƒã‚¹ã« v1 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚
https://x.com/tannerlinsley/status/1738709130213560497

ç¾åœ¨ã¯è‰²ã€…ãªæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ãŠã‚Šã€React ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦éå¸¸ã«äººæ°—ãŒã‚ã‚Šã¾ã™ã€‚

## TanStack Router ã®ç‰¹å¾´

### å‹å®‰å…¨ã®å‰å¤§ã•

TanStack Router ã¯ã€ãªã‚“ã¨ã„ã£ã¦ã‚‚å‹å®‰å…¨æ€§ãŒéå¸¸ã«é«˜ã„ã§ã™ã€‚
https://tanstack.com/router/latest/docs/framework/react/guide/type-safety

TanStack Router ã§ã¯ã€ãƒªãƒ³ã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ™‚ã«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã¨ãã€å­˜åœ¨ã—ã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‘ã‚¹ã ã‘ã‚’å‹ã¨ã—ã¦å—ã‘ä»˜ã‘ã€è£œå®Œã‚„ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãŸã€å‹•çš„ãƒ«ãƒ¼ãƒˆã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ã«ã¤ã„ã¦ã‚‚å®‰å…¨ã«æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

## å§‹ã‚ã¦ã¿ã‚‹

ã§ã¯ã€å®Ÿéš›ã«åˆ©ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†
ãªãŠã€å…¬å¼ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯èª¬æ˜ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
ã¾ãŸã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã¯ pnpm ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
pnpm create vite tanstack-router-lab --template react-ts
cd tanstack-router-lab
pnpm install
```

App.tsx ã‚’é©å½“ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ›¸ãæ›ãˆã¾ã™ã€‚

```tsx
export const Hello = () => {
  return (
    <div>
      <h1>Hello World</h1>
      <p>Click on the links above to see the code splitting in action.</p>
    </div>
  );
};
```

æ¬¡ã«ã€TanStack Router ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
pnpm add @tanstack/react-router
```

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨˜è¿°

ã§ã¯ã€`main.tsx`ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`route.tsx`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```tsx
import { createRootRoute, createRouter } from "@tanstack/react-router";
import { Hello } from "./App";

const rootRoute = createRootRoute({
  component: () => <Hello />,
});

const routeTree = rootRoute;

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ã“ã“ã§ã€ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’ã—ã¦ã„ãã¾ã™ã€‚

`createRootRoute` ã¯ã€æ ¹æœ¬ã®ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹é–¢æ•°ã§ã™ã€‚
`routeTree` ã¨ã¯ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’è¡¨ã™å¤‰æ•°ã§ã™ã€‚ä»Šå›ã¯ã€`rootRoute` ã ã‘ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
`createRouter`ã«`routeTree`ã‚’æ¸¡ã™ã“ã¨ã§ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã®`router`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

ã“ã“ã§ã€`createRootRoute` ã®å¼•æ•°ã« `component` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ãƒ«ãƒ¼ãƒˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

ã§ã¯ã€`main.tsx`ã«`RouterProvider`ã‚’è¿½åŠ ã—ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx
import { RouterProvider } from "@tanstack/react-router";
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { router } from "./route";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <RouterProvider router={router} />
  </StrictMode>
);
```

ã“ã“ã§ã¯ã€å…ˆç¨‹ä½œæˆã—ãŸ`router`ã‚’`RouterProvider`ã«æ¸¡ã™ã“ã¨ã§ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

vite ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã€`Hello` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-11-34-39.png)

```bash
pnpm run dev
```

### é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ 

TanStack Router ã«ã¯ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
pnpm add @tanstack/router-devtools
```

å°å…¥å¾Œã€`main.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import { RouterProvider } from "@tanstack/react-router";
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { router } from "./route";
import { TanStackRouterDevtools } from "@tanstack/router-devtools";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <RouterProvider router={router} />
    <TanStackRouterDevtools router={router} />
  </StrictMode>
);
```

ã“ã‚Œã§ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ä¾¿åˆ©ãªã®ã§æ˜¯éå°å…¥ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ãªãŠã€`RouterProvider`ã®å†…éƒ¨ã§`TanStackRouterDevtools`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯`router`ã‚’æ¸¡ã™å¿…è¦ãŒãªãã€è‡ªå‹•çš„ã«å–å¾—ã•ã‚Œã¾ã™ã€‚
ä»Šå›ã¯ã¾ã `RouterProvider`å†…éƒ¨ã§ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã—ã¦ã„ãªã„ãŸã‚ã€`RouterProvider`ã®å¤–ã§`router`ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚

### ä¸€èˆ¬çš„ãªãƒ«ãƒ¼ãƒˆ

ä¸€èˆ¬çš„ã«ã¯`Root`ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã›ãšã€`Root`ä»¥ä¸‹ã«åˆ¥é€”ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
import { Hello } from "./App";

const rootRoute = createRootRoute({});

const indexRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/",
  component: () => <Hello />,
});

const routeTree = rootRoute.addChildren([indexRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

`createRoute` ã¯ã€æ ¹æœ¬ã§ãªã„ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹é–¢æ•°ã§ã™ã€‚

`createRoute`ã§ã¯ã€`getParentRoute`ã¨`path`ãŒå¿…é ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚
`getParentRoute` ã¯ã€è¦ªã®ãƒ«ãƒ¼ãƒˆã‚’æŒ‡å®šã™ã‚‹é–¢æ•°ã§ã™ã€‚
`path` ã¯ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚
`component` ã«ã¯å…ˆç¨‹ã¨åŒæ§˜ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã¾ãŸã€`routeTree` ã«ã¯ã€`rootRoute` ã«å­ã®ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã—ãŸã‚‚ã®ã‚’æŒ‡å®šã—ã¾ã™ã€‚`addChildren` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€å­ã®ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€`/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã« `Hello` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### ãƒªãƒ³ã‚¯ã‚„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®å‹å®‰å…¨

TanStack Router ã§ã¯ã€ãƒªãƒ³ã‚¯ã‚„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

è©¦ã—ã«ã€`App.tsx`ã«ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
`Link` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
import { Link } from "@tanstack/react-router";

export const Hello = () => {
  return (
    <div>
      <h1>Hello World</h1>
      <p>Click on the links above to see the code splitting in action.</p>
      <Link to="/">Go to Home</Link>
    </div>
  );
};
```

ã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å­˜åœ¨ã™ã‚‹ãƒ‘ã‚¹ã‚’å‹ã¨ã—ã¦å—ã‘ä»˜ã‘ã€è£œå®ŒãŒåŠ¹ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![](/images/6680b272a2c2c5/2024-09-01-11-36-12.png)

ã¾ãŸã€ãƒªãƒ³ã‚¯ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚
`/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ãŒé·ç§»ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-11-36-28.png)

ã¾ãŸã€TanStack Router ã§ã¯`useNavigate`ã¨ã„ã†ãƒ•ãƒƒã‚¯ã‚‚æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®ãƒ•ãƒƒã‚¯ã®è¿”ã™`navigate`é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
import { Link, useNavigate } from "@tanstack/react-router";

export const Hello = () => {
  const navigate = useNavigate();
  return (
    <div>
      <h1>Hello World</h1>
      ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã›ãšã€ãƒ«ãƒ¼ãƒˆä»¥ä¸‹ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’åˆ¥é€”è¨˜è¿°ã—ã¾ã™ã€‚
      <p>Click on the links above to see the code splitting in action.</p>
      <Link to="/">Go to Home</Link>
      <button
        onClick={() =>
          navigate({
            to: "/",
          })
        }
      >
        Go to Lazy
      </button>
    </div>
  );
};
```

`navigate`é–¢æ•°ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã«å–ã‚Šã€`to`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚
ã“ã“ã§ã‚‚ã€å‹å®‰å…¨ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-11-39-12.png)
`/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã«ã¤ã„ã¦ã¯è¤‡é›‘ã§ã‚ã‚‹ãŸã‚ã€å¾Œã‹ã‚‰è§£èª¬ã—ã¾ã™ã€‚

## å¯èƒ½ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ

TanStack Router ã§ã¯ã€ãƒã‚¹ãƒˆã—ãŸãƒ«ãƒ¼ãƒˆã‚’ç°¡å˜ã«ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ãƒã‚¹ãƒˆã—ãŸãƒ«ãƒ¼ãƒˆã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§`<Outlet>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤–æ ã¨ãªã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç°¡å˜ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`<Outlet>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½¿ã„æ–¹ã¯ã€åŒã˜ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`react-router`ã¨ä¼¼ã¦ã„ã¾ã™ã€‚

ã§ã¯ã€`Layout.tsx`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```tsx
export const Layout = ({ children }: { children: React.ReactNode }) => {
  return (
    <div>
      <header>
        <h1>I'm a header</h1>
      </header>
      {children}
    </div>
  );
};
```

children ã§å—ã‘å–ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

ã§ã¯ã€`route.tsx`ã‚’è¨˜è¿°ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
  Outlet,
} from "@tanstack/react-router";
import { Hello } from "./App";
import { Layout } from "./Layout";

const rootRoute = createRootRoute({
  component: () => (
    <Layout>
      <Outlet />
    </Layout>
  ),
});

const indexRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/",
  component: () => <Hello />,
});

const routeTree = rootRoute.addChildren([indexRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

`Layout`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’`rootRoute`ã«æŒ‡å®šã—ã€ãã®ä¸­ã«`<Outlet>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é…ç½®ã—ã¾ã—ãŸã€‚

ã“ã‚Œã§ã€`Layout`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
`/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
![](/images/6680b272a2c2c5/2024-09-01-11-55-21.png)

`Hello`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`Layout`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¨ã—ã¦ã¯ã€è¦ªã®ãƒ«ãƒ¼ãƒˆã§å¤–æ ã¨ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã—ã€children ã«`<Outlet>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã®ãŒå¥½ã¾ã—ã„ã§ã—ã‚‡ã†ã€‚
ãã®ä¸Šã§ã€å­ã®ãƒ«ãƒ¼ãƒˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€å¤–æ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å­ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹å½¢ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’å¿œç”¨ã—ã¦ã€ç‰¹å®šã®ãƒ‘ã‚¹ä»¥ä¸‹ã«ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

`route.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
  Outlet,
} from "@tanstack/react-router";
import { Hello } from "./App";
import { Layout } from "./Layout";

const rootRoute = createRootRoute({});

const indexRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/hello",
  component: () => (
    <Layout>
      <Outlet />
    </Layout>
  ),
});

const helloRoute = createRoute({
  getParentRoute: () => indexRoute,
  path: "/foo",
  component: () => <Hello />,
});

const routeTree = rootRoute.addChildren([indexRoute.addChildren([helloRoute])]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ã“ã‚Œã§ã€`/hello/foo`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã«`Hello`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-06-07.png)

ã¾ãŸã€`/hello`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã«ã€`Layout`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ˜ãƒƒãƒ€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãªãŠã€ä¸­èº«ã«ã¤ã„ã¦ã¯ç©ºã§ã‚ã‚‹ãŸã‚ã€ä½•ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-06-16.png)

### ãƒ‘ã‚¹ç„¡ã—ã®ãƒ«ãƒ¼ãƒˆ

TanStack Router ã§ã¯ã€ãƒ‘ã‚¹ç„¡ã—ã®ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã¯ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰ã¯ã‚ã¾ã‚Šæ„å‘³ã®ãªã„æ©Ÿèƒ½ã§ã™ã€‚
ã—ã‹ã—ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ§‹é€ ã‚’é–¢å¿ƒäº‹ã§ã¾ã¨ã‚ãŸã„å ´åˆã«ã¯æœ‰ç”¨ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ä½¿ã„æ–¹ã¨ã—ã¦ã¯å…ˆç¨‹ã®ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã«ä¼¼ã¦ã„ã¾ã™ãŒã€ãƒ‘ã‚¹ã‚’æŒ‡å®šã›ãšã€id ã‚’æŒ‡å®šã™ã‚‹ã¨ã“ã‚ãŒç•°ãªã‚Šã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
const rootRoute = createRootRoute({});

const greetingRoute = createRoute({
  getParentRoute: () => rootRoute,
  id: "greeting",
});

const helloRoute = createRoute({
  getParentRoute: () => greetingRoute,
  path: "/hello",
  component: () => <p>Hello</p>,
});

const byeRoute = createRoute({
  getParentRoute: () => greetingRoute,
  path: "/bye",
  component: () => <p>Bye</p>,
});

const routeTree = rootRoute.addChildren([
  greetingRoute.addChildren([helloRoute, byeRoute]),
]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã—ã¦ã¯ã€`/hello`ã¨`/bye`ãŒå­˜åœ¨ã—ã¾ã™ãŒã€ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã¦æ‰±ã„ãŸã„ã‚‚ã®ã§ã™ã€‚
ã“ã®å ´åˆã«ã¯ã€ãƒ‘ã‚¹ç„¡ã—ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€`greeting`ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€ãã®å­ãƒ«ãƒ¼ãƒˆã¨ã—ã¦`/hello`ã¨`/bye`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`/hello`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`Hello`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-14-39.png)

`/bye`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`Bye`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-14-56.png)

### å‹•çš„ãƒ«ãƒ¼ãƒˆã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—

TanStack Router ã§ã¯ã€å‹•çš„ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å‹•çš„ãƒ«ãƒ¼ãƒˆã¨ã¯ã€ãƒ‘ã‚¹ã®ä¸€éƒ¨ã‚’å‹•çš„ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ«ãƒ¼ãƒˆã®ã“ã¨ã§ã™ã€‚
ãƒ‘ã‚¹ã«`$`ã‹ã‚‰å§‹ã¾ã‚‹å¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€å‹•çš„ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

ã§ã¯ã€`route.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
import { Hello } from "./App";
const rootRoute = createRootRoute({});

const helloRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/$helloId",
  component: () => <Hello />,
});
const routeTree = rootRoute.addChildren([helloRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

`helloId`ã¨ã„ã†å¤‰æ•°ã‚’`$`ã§æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

`/(ä»»æ„ã®æ–‡å­—åˆ—)`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€`Hello`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-32-30.png)

æ›´ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§`useParams`ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
import { useParams } from "@tanstack/react-router";

export const Hello = () => {
  const { helloId } = useParams({ from: "/$helloId" });
  return (
    <div>
      <h1>Hello World</h1>
      <p>Click on the links above to see the code splitting in action.</p>
      <p>
        The current helloId is: <strong>{helloId}</strong>
      </p>
    </div>
  );
};
```

`useParams`ãƒ•ãƒƒã‚¯ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã«å–ã‚Šã€`from`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã§ã¯ã€`/(ä»»æ„ã®æ–‡å­—åˆ—)`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-34-25.png)

![](/images/6680b272a2c2c5/2024-09-01-12-33-46.png)

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŒ‡å®š

TanStack Router ã§ã¯ã€ã„ãã¤ã‹ã®ç‰¹å¾´çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæŒ‡å®šã§ãã¾ã™ã€‚

ä»Šã¾ã§ã®ä¾‹ã§ã¯ã€`component`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã€‚
ã“ã‚Œä»¥å¤–ã«ã‚‚ã€ãƒ«ãƒ¼ãƒˆã«ãŠã„ã¦æŒ‡å®šã§ãã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã™ã€‚

#### Not Found ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

å­˜åœ¨ã—ãªã„ãƒ«ãƒ¼ãƒˆã§ã‚ã£ãŸã¨ãã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚
è¦ªã®ãƒ«ãƒ¼ãƒˆã‹ã€ä¸€ç•ªä¸Šã®ãƒ«ãƒ¼ãƒˆã«æŒ‡å®šã—ã¾ã™ã€‚
ä»Šå›ã¯ã€ä¸€ç•ªä¸Šã®`rootRoute`ã«æŒ‡å®šã—ã¾ã™ã€‚

`route.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
import { Hello } from "./App";
const rootRoute = createRootRoute({
  notFoundComponent: () => <div>Not Found... sorry</div>,
});

const helloRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/hello",
  component: () => <Hello />,
});
const routeTree = rootRoute.addChildren([helloRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ã§ã¯ã€`/hello`ä»¥å¤–ã®ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-38-57.png)

![](/images/6680b272a2c2c5/2024-09-01-12-39-35.png)

ã“ã®ã‚ˆã†ã«ã€å­˜åœ¨ã—ãªã„ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã«`Not Found... sorry`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

#### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

é€šå¸¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã—ãŸã¨ãã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

`App.tsx`ã«ã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã™å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
export const Hello = () => {
  // ãƒ©ãƒ³ãƒ€ãƒ ã§ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹
  if (Math.random() > 0.5) {
    throw new Error("Random error");
  }

  return (
    <div>
      <h1>Hello World</h1>
      <p>Click on the links above to see the code splitting in action.</p>
    </div>
  );
};
```

`route.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
import { Hello } from "./App";
const rootRoute = createRootRoute({
  notFoundComponent: () => <div>Not Found... sorry</div>,
});

const helloRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/hello",
  component: () => <Hello />,
  errorComponent: () => <div>There was an error!! Sorry</div>,
});
const routeTree = rootRoute.addChildren([helloRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ã§ã¯ã€`/hello`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-53-02.png)

50%ã®ç¢ºç‡ã§ã€æ­£å¸¸ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-12-53-42.png)

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã¨ãã«ã€`There was an error!! Sorry`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

æŒ‡å®šã—ãŸã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

#### Pending ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

Pending ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€é€šå¸¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

ã“ã‚Œã‚’è§£èª¬ã™ã‚‹å‰ã«ã€React ã®ã‚µã‚¹ãƒšãƒ³ãƒ‰ã¨ Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚

React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§åˆæœŸãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãªã©ã‚’è¡Œã†å ´åˆã€ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã‚‹ã¾ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€Œãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ãªã®ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ããªã„ã€ã¨ã„ã†çŠ¶æ…‹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã®çŠ¶æ…‹ã‚’ã‚µã‚¹ãƒšãƒ³ãƒ‰ã¨ã„ã„ã¾ã™ãŒã€ã“ã®çŠ¶æ…‹ã§ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã€ã“ã®ã‚ˆã†ãªçŠ¶æ…‹ã«ãªã‚Šã†ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã—ã€ä¸­èº«ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚µã‚¹ãƒšãƒ³ãƒ‰çŠ¶æ…‹ã§ã‚ã‚‹å ´åˆã«åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ãªã£ã¦ãã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`Suspense`ã§ã™ã€‚

https://zenn.dev/uhyo/books/react-concurrent-handson/viewer/what-is-suspense

```tsx
<Suspense fallback={<div>ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ãŸã‚‰ã“ã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹</div>}>
  {/* â†“ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ãªã‹ã£ãŸã‚‰ã“ã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ */}
  <MyComponent />
</Suspense>
```

TanStack Router ã§ã¯ã€Pending ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€è‡ªå‰ã§ Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ãªãã€ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ãŸã‚‰è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã—ãŸãŒã£ã¦ã€ã‚µã‚¹ãƒšãƒ³ãƒ‰ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚ˆã‚Šç°¡å˜ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ã€‚

è©¦ã—ã«ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’éåŒæœŸã§è¡Œã†å®Ÿè£…ã§è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æ”¯æ´ã™ã‚‹å®Ÿè£…ã¨ã—ã¦ã€TanStack Query ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¯ fetch é–¢æ•°ã§è¡Œã†ã®ã§ã™ãŒã€ãã®é–“ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚µã‚¹ãƒšãƒ³ãƒ‰ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
pnpm add @tanstack/react-query
```

ã¾ãš TanStack Query ã‚’åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã€`main.tsx`ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```tsx
import { RouterProvider } from "@tanstack/react-router";
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { router } from "./route";
import { TanStackRouterDevtools } from "@tanstack/router-devtools";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

const queryClient = new QueryClient();

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
      <TanStackRouterDevtools router={router} />
    </QueryClientProvider>
  </StrictMode>
);
```

æ¬¡ã«ã€`App.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import { useSuspenseQuery } from "@tanstack/react-query";

export const Hello = () => {
  // 3ç§’é…å»¶ã—ã¦è¿”å´ã•ã‚Œã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å©ã„ã¦ã¿ã‚‹
  const { data } = useSuspenseQuery({
    queryKey: ["hello"],
    queryFn: async () => {
      const response = await fetch("https://httpbin.org/delay/3");
      return response.json();
    },
  });

  return (
    <div>
      <h1>Hello World</h1>
      <p>Click on the links above to see the code splitting in action.</p>
      <p>{JSON.stringify(data)}</p>
    </div>
  );
};
```

`useSuspenseQuery`ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ã‚’è¡Œã„ã€ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚µã‚¹ãƒšãƒ³ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`https://httpbin.org/delay/3`ã¨ã¯ã€3 ç§’é…å»¶ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

æœ€å¾Œã«ã€`route.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";
import { Hello } from "./App";
const rootRoute = createRootRoute({
  notFoundComponent: () => <div>Not Found... sorry</div>,
});

const helloRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/hello",
  component: () => <Hello />,
  pendingComponent: () => <div>Loading...Please wait</div>,
  errorComponent: () => <div>There was an error!! Sorry</div>,
});
const routeTree = rootRoute.addChildren([helloRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

`pendingComponent`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã§ã¯ã€`/hello`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](/images/6680b272a2c2c5/2024-09-01-13-12-42.png)

`Loading...Please wait`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](/images/6680b272a2c2c5/2024-09-01-13-13-18.png)

3 ç§’å¾Œã«ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã€è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

## å…¬å¼ãŒæä¾›ã—ã¦ã„ã‚‹ãã®ä»–ã®æ©Ÿèƒ½

### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### é…å»¶èª­ã¿è¾¼ã¿ã§åŠ¹ç‡åŒ–

TanStack Router ã§ã¯ã€åˆæœŸçŠ¶æ…‹ã§èª­ã¿è¾¼ã¾ãªãã¦è‰¯ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€åˆæœŸèª­ã¿è¾¼ã¿ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ãŒã§ãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã«ã¤ãªãŒã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯ã€ä¸€èˆ¬çš„ãªãƒ«ãƒ¼ãƒˆã«å¯¾ã™ã‚‹é…å»¶èª­ã¿è¾¼ã¿ã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚

ã¾ãšã€é…å»¶èª­ã¿è¾¼ã¿ã—ãŸã„ãƒ«ãƒ¼ãƒˆã«ã¤ã„ã¦ã€åˆ¥é€”ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã™ã€‚
ã“ã“ã§ã¯ã€`IndexLazyRoute.tsx` ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã™ã€‚

```tsx
import { createLazyRoute } from "@tanstack/react-router";
import { Hello } from "./App";

export const indexLazyRoute = createLazyRoute("/")({
  component: () => <Hello />,
});
```

ã“ã®ã‚ˆã†ã«ã—ã¦ã€é…å»¶èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹ãƒ«ãƒ¼ãƒˆ(ä»¥ä¸‹ã€é…å»¶ãƒ«ãƒ¼ãƒˆ)ã‚’ä½œæˆã—ã¾ã™ã€‚

æ¬¡ã«ã€`route.tsx` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```tsx
import {
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router";

const rootRoute = createRootRoute({});

const indexRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/",
}).lazy(() => import("./IndexLazyRoute").then((d) => d.IndexLazyRoute));

const routeTree = rootRoute.addChildren([indexRoute]);

export const router = createRouter({ routeTree });

declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}
```

ã“ã‚Œã§ã€`/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã« `Hello` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ã¯åˆæœŸãƒšãƒ¼ã‚¸ã§ã‚ã‚‹ãŸã‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã™ãèª­ã¿è¾¼ã¿ã•ã‚Œã€é…å»¶ã®åŠ¹æœã¯æ„Ÿã˜ã‚‰ã‚Œã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€åˆæœŸãƒšãƒ¼ã‚¸ä»¥å¤–ã®ãƒšãƒ¼ã‚¸ã«é©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

`createLazyRoute` ã¯ã€é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ãŸã‚ã®é–¢æ•°ã§ã™ã€‚
ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã“ã“ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®é…å»¶èª­ã¿è¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚
é€šå¸¸ãƒ«ãƒ¼ãƒˆã‹ã‚‰`lazy`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€é…å»¶èª­ã¿è¾¼ã¿ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã§ã¯ã€ã©ã®ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯é…å»¶ã™ã‚‹ã¹ããªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€é…å»¶ã™ã‚‹ã¹ãã‚‚ã®ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

- é€šå¸¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- Pending ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- Not Found ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ã¹ãã ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚
è©³ã—ãã¯ã€ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- https://tanstack.com/router/v1/docs/framework/react/guide/code-splitting

## ã¾ã¨ã‚

ä»Šå›ã¯ã€TanStack Router ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ã•ã‚‰ã«å¤šãã®æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- SSR
- ãƒ­ãƒ¼ãƒ€ãƒ¼

èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

https://tanstack.com/router/v1

ã§ã¯ã€æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
