---
title: "疑問と答えで進めるOAuth/OIDCの理解"
emoji: "🌊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["OAuth", "OIDC", "PKCE"]
published: false
---

# はじめに

こんにちは。calloc134 です。

ここ最近、OAuth と OIDC について調べていました。
その際、なかなか躓くところが多く、調査に苦労しました。

今回は、疑問と答えを交えながら、OAuth と OIDC について理解を深めていきたいと思います。

この記事を書くにあたり、ritou さん・Auth 屋さんの記事や書籍を参考にさせていただきました。
この場を借りて感謝申し上げます。

# お断り

この記事では、認可コードフローをメインに扱います。
インプリシットフローについては、必要になった段階で最低限の説明を行います。

# 簡単な前提知識

疑問と答えの対応を行う前に、簡単な前提知識を共有しておきます。

## OAuth のフロー

## OIDC のフロー

## PKCE とは

## state とは

## JWT とは

https://qiita.com/TakahikoKawasaki/items/185d34814eb9f7ac7ef3

# 疑問と答え

## クライアントって、フロントエンドのこと？

OAuth では、クライアントという言葉が登場します。
しかし、クライアントといっても、必ずしもユーザのフロントエンド(具体的には、Web ブラウザやモバイルアプリ)を指すわけではありません。
クライアントがユーザのフロントエンドになる場合とそうでない場合について、それぞれを比較して考えてみましょう。

### クライアントがユーザのフロントエンドでない場合

クライアントがユーザのフロントエンドでない場合、バックエンドサーバがクライアントに相当します。この場合のクライアントは、`Confidential Client` と呼ばれます。

このときの OAuth フローについてまとめてみます。

(ここに OAuth フローの図を挿入)

アクセストークンは、 認可サーバがクライアントに返却します。
クライアントがバックエンドサーバであるため、フロントエンド側であるユーザはアクセストークンを一切手にすることが出来ません。

アクセストークンがユーザ側に返されないことが、`Confidential Client`の大きな特徴です。

### クライアントがユーザのフロントエンドである場合

クライアントがユーザのフロントエンドである場合、フロントエンドサーバがクライアントに相当します。この場合のクライアントは、`Public Client` と呼ばれます。

このときの OAuth フローについてまとめてみます。

(ここに OAuth フローの図を挿入)

アクセストークンは認可サーバからクライアントに返されますが、クライアントがユーザのフロントエンドであるため、アクセストークンをユーザが取得することになります。
アクセストークンをユーザが手にすることが出来るということが、`Public Client`の大きな特徴です。

### 余談

クライアントがユーザのフロントエンドであるか、それともバックエンドであるかについて、はっきり区分できないパターンについても存在します。
大事なのは、フロントエンドのユーザがアクセストークンを受け取るかどうか、という点です。
詳しい解説については、以下の記事を確認いただけると幸いです。
https://zenn.dev/ritou/articles/d26c7861047a2d#%22public%22-client-%2B-backend-server

参考リンク
https://zenn.dev/ritou/articles/d26c7861047a2d

## OAuth は認可・OIDC は認証って言うけど、本当ですか

https://ritou.hatenablog.com/entry/2020/12/01/000000

OAuth は認可・OIDC は認証！というフレーズに関しては、少し足りていない情報が存在するかもしれません。このフレーズに関しては、以下のように言い方を改めると好ましいと思います。

- OAuth は、ユーザが、所有するリソースのアクセス権を第三者に移譲するための仕組み
- OIDC は、ユーザが、ユーザの身分証明を第三者にも信頼してもらうための仕組み

何に対しての認可・認証かについて、明確にすることが大切です。
このようにして考えると、OAuth と OIDC のユースケースは全く異なるものであることが分かります。

OAuth はリソース移譲のための仕組みなのですが、この仕組みを用いてユーザの属性情報を扱うことで、ユーザの身分証明のための仕組みを実現できるのでは？ということで OAuth が認証用途に利用されはじめました。
OAuth が登場する以前から、OIDC のベースとなる認証の仕組みとして OpenID というものが存在していました。OAuth を認証用途として利用する広まりを受け、OAuth2.0 で土台を整えつつ、認証用途としての仕組みを追加した OIDC が登場した、というのが経緯のようです。
この経緯についてはわかりやすさのための少し省略されていますが、Auth 屋さんの本に詳しい解説があるので、そちらを参照いただけると幸いです。

参考リンク
https://ritou.hatenablog.com/entry/2024/02/11/153633
https://booth.pm/ja/items/1550861
(P. 86)

## OAuth を認証に使うと脆弱性になると言うけど、説明できません…

https://authya.booth.pm/items/1550861

名無しの鍵問題

(ここで軽くインプリシットフローについて解説。また、Public Client については PKCE が存在するため現在は特に推奨されないことを解説)

## OIDC が登場する前は、どうやって身分証明を行っていたの？また、それで何が問題だったの？

https://www.sakimura.org/2012/02/1487/

## OAuth でプロフィール認証を行う欠点を、OIDC でどのように補っている？

https://ritou.hatenablog.com/entry/2020/12/01/000000
(二回目)

## Client Secret って何？

https://qiita.com/TakahikoKawasaki/items/63ed4a9d8d6e5109e401

## OAuth/OIDC で PKCE というものは何を保証するの？

https://ritou.hatenablog.com/entry/20151018/1445181974

https://qiita.com/TakahikoKawasaki/items/8567c80528da43c7e844

## OAuth/OIDC での state は何を保証するの？

https://ritou.hatenablog.com/entry/2019/12/02/060000

## JWT が利用されているのは、ID トークンだけ？

https://ritou.hatenablog.com/entry/2023/10/08/215035

https://qiita.com/TakahikoKawasaki/items/970548727761f9e02bcd

## ID トークンの中身はどのように構成されている？

https://qiita.com/TakahikoKawasaki/items/8f0e422c7edd2d220e06
