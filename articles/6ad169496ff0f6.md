---
title: "reactから@metamask/sdk-reactを使ってみる"
emoji: "🦊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react", "web3", "metamask"]
published: false
---

## はじめに

こんにちは。calloc134 です。

さて、先日 Nagoya Web3 Hackathon に参加しました。
このときに react と metamask を接続する必要がありました。

普通は web3.js を使うのですが、今回はまた別の選択肢として、@metamask/sdk-react を使ってみました。
https://github.com/MetaMask/metamask-sdk

このライブラリは Github を確認したところ、公式が開発しているようでした。
しかし、ドキュメントがまだ存在せず、開発中のライブラリのようでした。

そんなライブラリを今回のハッカソンでは使ってみました。
このライブラリの使い方がドキュメントとして存在しなかったため、メモとして残しておきます。

## 使い方

### 1. ライブラリのインストール

まずはライブラリをインストールします。
今回はパッケージマネージャに pnpm を使っています。

```bash
pnpm add @metamask/sdk-react
```

### 2. react からライブラリをインポート

次に、react からライブラリをインポートします。
metamask のコンポーネントやフックを利用するためには、MetaMaskProvider というプロバイダでコンポーネントをラップする必要があるため、ルートに近いところでインポートします。

```tsx
import { MetaMaskProvider } from "@metamask/sdk-react";
(...)

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  <React.StrictMode>
    <MetaMaskProvider
      sdkOptions={{
        dappMetadata: {
          name: "(適当なアプリケーション名)",
          url: "(適当なURL)",
        },
        # metamaskがインストールされているかを起動直後にチェックするかどうか
        checkInstallationImmediately: false,
      }}
    >
      (childrenのコンポーネントを記述)
    </MetaMaskProvider>
  </React.StrictMode>,
);
```

これで、metamask のコンポーネントやフックを利用することができるようになります。

## ログインボタンを埋め込み

metamask の提供するログインボタンは以下のようにして埋め込むことができます。

```tsx
import { MetaMaskButton } from "@metamask/sdk-react";
(...)

function App() {
  return (
    <div className="App">
      <MetaMaskButton />
    </div>
  );
}
```

以下のようなボタンが表示されます。

![](/images/6ad169496ff0f6/2023-08-23-22-53-31.png)

このボタンを押すと、ブラウザに存在する拡張機能として metamask が起動し、ログインを行うことができます。

metamask のログイン後は以下のような画面となります。

![](/images/6ad169496ff0f6/2023-08-23-22-54-36.png)

## サンプル: 送金処理

@metamask/react-sdk のフックは数多く存在します。

ここでは、送金するためのフックを用いて、送金処理を行うサンプルを紹介します。

```tsx
import { useSendTransaction } from "@metamask/sdk-react";

(...)

function App() {
  // トランザクション用フック
  const { data, isSuccess, sendTransaction } = useSendTransaction({
    to: "0x57dc7A6D9Aa8cc04E8fb629C5AC298b02C85F1e4",
    value: BigInt(transaction.amount * 10 ** 18),
  });

  return (
    <div className="App">
      <button onClick={() => sendTransaction()} />
      {isSuccess && <p>送金完了</p>}
    </div>
  );
}
```

ここで、useSendTransaction の引数には、送金先のアドレスと送金額を指定します。
この送金額は、BigInt 型で指定し、単位は wei であるため、送金額を 10^18 倍しています。

また、useSendTransaction の戻り値には、送金処理の状態を示す isSuccess と、送金処理を実行するための sendTransaction が含まれています。
フックの利用のイメージとしては react-query や apollo client のミューテーションのような感じです。

これを実行すると、metamask で送金処理を行うかどうかの確認が表示されます。

![](/images/6ad169496ff0f6/2023-08-23-23-00-07.png)

成功すると isSuccess が true になり、送金完了と表示されます。

## おわりに

今回は、react から@metamask/sdk-react を使って metamask と接続する方法を紹介しました。
web3.js 以外の選択肢として参考になれば幸いです。

## 捕捉

このライブラリの開発者が過去に作っていたライブラリがあるのですが、このライブラリのフックと metamask の react-sdk のフックの API はある程度共通であるようです。
そのため、このライブラリのフックのドキュメントがない場合は、以下のライブラリのドキュメントを参考にすると良いかもしれません。

https://wagmi.sh/react
https://wagmi.sh/examples/connect-wallet

ではでは。
