---
title: "NestJSã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä½™å‰°å…¬é–‹ã‚’é˜²ããŸã‚ã«"
emoji: "ğŸº"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nestjs", "typescript", "NestJS", "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"]
published: false
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€calloc134 ã§ã™ã€‚
çš†ã•ã‚“ã¯ã€API ã‚’ä½œæˆã™ã‚‹ã¨ãã«ã©ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã‹ï¼Ÿ

ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™ API ã‚’ä½œæˆã™ã‚‹ã¨ãã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚

```json
{
  "id": 1,
  "name": "calloc134"
}
```

ã“ã® API ã¯ç‰¹ã«å•é¡Œã¯ãªã„ã§ã™ã­ã€‚
ã—ã‹ã—ã€ã“ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ API ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚

```json
{
  "id": 1,
  "name": "calloc134",
  "password": "$argon2i$v=19$m=16,t=2,p=1$MTIzNDU2Nzg$ZZ/eAcHRleU4ChG0EJ+2Mw",
  "createdAt": "2021-06-03T14:00:00.000Z",
  "updatedAt": "2021-06-03T14:00:00.000Z"
  ...
}
```

ãŠãã‚‰ãã€ã“ã® API ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æƒ…å ±ã‚’ãã®ã¾ã¾è¿”ã—ã¦ã„ã‚‹ã®ã ã¨æ€ã„ã¾ã™ã€‚
ã—ã‹ã—ã€ã“ã® API ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚
ç‰¹ã«`password`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ã§ã‚ã‚Šã€å…¬é–‹ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

ã“ã®ã‚ˆã†ã«ãªã‚‹ã®ã¯é¿ã‘ãŸã„ã§ã™ã‚ˆã­ãƒ»ãƒ»ãƒ»ã€‚

## NestJS ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹

NestJS ã® Service ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ã‚’è¿”å´ã—ã¦ã„ãŸã¨ã—ã¾ã™ã€‚

```ts
import { Controller, Get } from "@nestjs/common";
import { PrismaService } from "src/prisma.module";

@Injecable()
export class UserService {
  constructor(private readonly prisma: PrismaService) {}

  async findOne(id: number): Promise<User> {
    return this.prisma.user.findUniqueOrThrow({
      where: { id },
    });
  }
}
```

ã—ã‹ã—ã€ã“ã‚Œã ã¨`password`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã‚Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ã€`class-transformer`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã™ã€‚

```bash
npm install class-transformer
```

æ¬¡ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ã®å‹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ts
import { Expose } from "class-transformer";

export class UserResponse {
  @Expose()
  id: number;

  @Expose()
  name: string;

  constructor(partial: Partial<LimitedUserResDto>) {
    Object.assign(this, partial);
  }
}
```

`@Expose()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã€ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå…¬é–‹ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€UserService ã§ä»¥ä¸‹ã®ã‚ˆã†ã« UserResponse ã‚’ new ã—ã¦è¿”å´ã—ã¾ã™ã€‚

```ts
import { Injecable } from "@nestjs/common";
import { PrismaService } from "src/prisma.module";

@Injecable()
export class UserService {
  constructor(private readonly prisma: PrismaService) {}

  async findOne(id: number): Promise<UserResponse> {
    const user = await this.prisma.user.findUniqueOrThrow({
      where: { id },
    });
    return new UserResponse(user);
  }
}
```

æœ€å¾Œã«ã€main.ts ã«ãŠã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’è¨­å®šã—ã¾ã™ã€‚

```ts
import { ClassSerializerInterceptor, ... } from '@nestjs/common';

async function bootstrap() {
  // ...
  const app = await NestFactory.create(AppModule);

  (...)

  // ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’æœ‰åŠ¹åŒ–
  app.useGlobalInterceptors(
    new ClassSerializerInterceptor(app.get(Reflector), {
      excludeExtraneousValues: true,
    })
  )

  // ...
  await app.listen(3000);
}
bootstrap();
```

ã“ã“ã§ã€`excludeExtraneousValues`ã‚’`true`ã«ã™ã‚‹ã“ã¨ã§ã€`@Expose()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãŒã¤ã„ã¦ã„ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é™¤å¤–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã§ã€`password`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ã¾ã¨ã‚

ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚
